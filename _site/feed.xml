<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="zh"><generator uri="https://jekyllrb.com/" version="4.2.0">Jekyll</generator><link href="/feed.xml" rel="self" type="application/atom+xml" /><link href="/" rel="alternate" type="text/html" hreflang="zh" /><updated>2023-03-04T01:15:32+08:00</updated><id>/feed.xml</id><title type="html">CYâ€™s blog</title><subtitle>è¼ãæ˜Ÿã«ãªã‚‹
</subtitle><author><name>CY</name></author><entry><title type="html">ã€Šæ“ä½œç³»ç»Ÿï¼šè®¾è®¡ä¸å®ç°ã€‹å­¦ä¹ ç¬”è®°ä¸€</title><link href="/2023/03/02/JYY-Lec1.html" rel="alternate" type="text/html" title="ã€Šæ“ä½œç³»ç»Ÿï¼šè®¾è®¡ä¸å®ç°ã€‹å­¦ä¹ ç¬”è®°ä¸€" /><published>2023-03-02T00:00:00+08:00</published><updated>2023-03-02T00:00:00+08:00</updated><id>/2023/03/02/JYY-Lec1</id><content type="html" xml:base="/2023/03/02/JYY-Lec1.html">&lt;!--more--&gt;
&lt;p&gt;æœ¬ç³»åˆ—æ˜¯å—äº¬å¤§å­¦è’‹ç‚å²©è€å¸ˆçš„æ“ä½œç³»ç»Ÿè¯¾ç¨‹å­¦ä¹ ç¬”è®°&lt;/p&gt;

&lt;p&gt;è¯¾ç¨‹ä¸»é¡µï¼š&lt;a href=&quot;http://jyywiki.cn/OS/2022/&quot;&gt;è€å¸ˆçš„wiki&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;è¯¾ç¨‹è§†é¢‘ï¼š&lt;a href=&quot;https://space.bilibili.com/202224425/channel/collectiondetail?sid=192498&quot;&gt;Bç«™åˆé›†&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;ç¬¬ä¸€èŠ‚è¯¾å›ç­”äº†ä¸€ä¸ªé—®é¢˜ï¼šä»€ä¹ˆæ˜¯ç¨‹åº&lt;/p&gt;

&lt;p&gt;ç”±äºä½¿ç”¨çš„æ˜¯sshç™»å½•linuxæœºå™¨æ¥å­¦ä¹ ï¼Œè¿™é‡Œä¹Ÿè®°å½•ä¸€ä¸‹&lt;/p&gt;

&lt;p class=&quot;info&quot;&gt;ğŸ“Œ ä½¿ç”¨sshç™»å½•linuxçš„æ–¹æ³•ï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ssh username@remote_host&lt;/code&gt;ï¼Œä¾‹å¦‚:&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ssh cy@127.0.0.1&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;æ•°å­—ç”µè·¯ä¸çŠ¶æ€æœº&quot;&gt;æ•°å­—ç”µè·¯ä¸çŠ¶æ€æœº&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆä»‹ç»äº†ä»€ä¹ˆæ˜¯çŠ¶æ€æœºï¼ŒçŠ¶æ€æœºå¯ä»¥ç†è§£ä¸ºæ•°å­—ç”µè·¯çš„æœ‰é™ç§çŠ¶æ€çš„é›†åˆï¼Œæ•°å­—ç”µè·¯çš„åˆå§‹å€¼å³ä½çŠ¶æ€æœºçš„åˆå§‹çŠ¶æ€ï¼ŒçŠ¶æ€ä¹‹é—´çš„è¿ç§»é€šè¿‡ç»„åˆé€»è¾‘ç”µè·¯æ¥è®¡ç®—å‡ºä¸‹ä¸€ä¸ªçŠ¶æ€
æ¯”å¦‚æœ‰ä¸¤ä¸ªå¯„å­˜å™¨Xï¼ŒYï¼Œåˆå§‹å€¼å‡ä¸º0ï¼Œå®ç°çš„æ•°å­—ç”µè·¯ä¸ºï¼š&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Y&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;Y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;X&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Y&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;é‚£ä¹ˆçŠ¶æ€æœºå°±ä¼šç»å†å¦‚ä¸‹çš„çŠ¶æ€è¿ç§»ï¼š
(0, 0) -&amp;gt; (0, 1) -&amp;gt; (1, 0) -&amp;gt; (0, 0) â€¦&lt;/p&gt;

&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯ç¨‹åºæºä»£ç è§†è§’&quot;&gt;ä»€ä¹ˆæ˜¯ç¨‹åºï¼ˆæºä»£ç è§†è§’ï¼‰&lt;/h2&gt;
&lt;p&gt;ä»æºä»£ç çš„è§’åº¦æ¥çœ‹ï¼Œç¨‹åºä¹Ÿæ˜¯çŠ¶æ€æœºã€‚ç®€å•çš„ç†è§£ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;çŠ¶æ€å°±æ˜¯ç¨‹åºçš„å †å’Œæ ˆ&lt;/li&gt;
  &lt;li&gt;è¿ç§»æ–¹å¼å°±æ˜¯æ¯æ¬¡æ‰§è¡Œçš„æŒ‡ä»¤&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¦‚æœç”¨gdbæ¥è°ƒè¯•ï¼Œæˆ‘ä»¬ä¼šæ›´ç›´è§‚çš„æ„Ÿå—åˆ°ï¼ŒPCï¼ˆç¨‹åºè®¡æ•°å™¨ï¼‰æ€»æ˜¯æŒ‡å‘æŸä¸€æ¡æŒ‡ä»¤ï¼Œæ‰§è¡Œè¯¥æŒ‡ä»¤ååˆ™è·³è½¬åˆ°ä¸‹ä¸€æ¡&lt;/p&gt;

&lt;p class=&quot;info&quot;&gt;ğŸ“Œ è®¾ç½®gdbå±•ç¤ºæºä»£ç ï¼š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;layout src&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/JYYOS/lec1/hello.png&quot; alt=&quot;Image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;æ›´æ·±å±‚æ¬¡çš„ç†è§£ï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;çŠ¶æ€ = æ ˆå¸§åˆ—è¡¨ï¼ˆæ¯ä¸ªæ ˆå¸§æœ‰å¯¹åº”çš„PCï¼‰+ å…¨å±€å˜é‡&lt;/li&gt;
  &lt;li&gt;åˆå§‹çŠ¶æ€ = main(argc, argv) + å…¨å±€å˜é‡åˆå§‹åŒ–&lt;/li&gt;
  &lt;li&gt;çŠ¶æ€è¿ç§» = æ‰§è¡Œtop stack frameçš„PCå¯¹åº”çš„è¯­å¥ï¼ŒPC++
    &lt;ul&gt;
      &lt;li&gt;å‡½æ•°è°ƒç”¨ = push frame (frame.PC = å…¥å£)&lt;/li&gt;
      &lt;li&gt;å‡½æ•°è¿”å› = pop frame&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ¥çœ‹ä¸€ä¸ªé€’å½’å®ç°çš„æ±‰è¯ºå¡”ç¨‹åºï¼Œä¸éš¾ç†è§£&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#include &amp;lt;stdio.h&amp;gt;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hanoi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;via&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;%c -&amp;gt; %c&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;hanoi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;via&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;hanoi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;via&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;hanoi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;via&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;hanoi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;A&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;B&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;C&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Output&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;A&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;C&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;A&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;B&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;C&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;B&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;A&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;C&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;B&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;A&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;B&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;C&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;A&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;C&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å½“ç†è§£äº†ç¨‹åºæ˜¯çŠ¶æ€æœºè¿™ä¸€åŸç†ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å˜æ ˆå¸§çš„æ–¹å¼å°†å…¶æ”¹å†™ä¸ºéé€’å½’çš„å½¢å¼&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#include &amp;lt;stdio.h&amp;gt;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;typedef&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;via&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;#define call(...) ({ *(++top) = (Frame) {.pc = 0, __VA_ARGS__}; })&lt;/span&gt;
&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;æ³¨æ„ï¼šè¿™é‡Œä¸ºä»€ä¹ˆæ˜¯&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ï¼Ÿå› ä¸º&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;å¾ªç¯å†…ä¼šè‡ªåŠ¨è®©&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#define go(n) ({ f-&amp;gt;pc = n - 1; })&lt;/span&gt;
&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;æ³¨æ„ï¼šè¿™é‡Œéœ€è¦è®¾ç½®&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;å—ï¼Ÿä¸éœ€è¦ï¼Œå› ä¸ºå½“å‰çš„æ ˆå¸§éƒ½æ²¡ç”¨äº†ï¼Œä¸‹æ¬¡å¾ªç¯æ—¶&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ä¼šæŒ‡å‘ä¸Šä¸€ä¸ªæ ˆå¸§ï¼Œå¹¶ä»è¯¥æ ˆå¸§çš„&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pc&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ç»§ç»­æ‰§è¡Œ&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;#define ret() ({ --top; }) &lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hanoi_nr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;via&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;Frame&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;top&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stack&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;via&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Frame&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;top&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;%c -&amp;gt; %c&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;go&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;via&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;via&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;via&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;ret&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hanoi_nr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;A&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;B&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;C&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è¿™æ®µä»£ç å…¶å®å°±æ˜¯é€’å½’çš„å½¢å¼ï¼Œåªä¸è¿‡æˆ‘ä»¬å°†é€’å½’çš„è°ƒç”¨æ”¹æˆäº†æ“ä½œæ ˆå¸§å’ŒPCçš„å½¢å¼ã€‚æ¯æ¬¡é€’å½’è°ƒç”¨æ—¶å°±åˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œæ ¹æ®æ ˆå¸§å†…PCçš„ä¸åŒå€¼æ‰§è¡Œå¯¹åº”çš„è¯­å¥ã€‚è¿™é‡Œæ¯ä¸ªæ ˆå¸§çš„å¤§å°æ˜¯ä¸€æ ·çš„ï¼Œåªæœ‰ä¸¤ä¸ªintå’Œä¸‰ä¸ªcharï¼Œåœ¨ä¸€èˆ¬çš„ç¨‹åºä¸­ï¼Œæ ˆå¸§å¤§å°é€šå¸¸è·Ÿå½“å‰å‡½æ•°çš„å±€éƒ¨å˜é‡ä¸ªæ•°æœ‰å…³ï¼Œä½†åŸç†æ˜¯ä¸€æ ·çš„&lt;/p&gt;

&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯ç¨‹åºäºŒè¿›åˆ¶è§†è§’&quot;&gt;ä»€ä¹ˆæ˜¯ç¨‹åºï¼ˆäºŒè¿›åˆ¶è§†è§’ï¼‰&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;çŠ¶æ€ = å¯„å­˜å™¨Rï¼Œå†…å­˜M&lt;/li&gt;
  &lt;li&gt;åˆå§‹çŠ¶æ€ = ï¼Ÿï¼ˆåç»­è§£é‡Šï¼‰&lt;/li&gt;
  &lt;li&gt;è¿ç§» = æ‰§è¡Œä¸€æ¡æŒ‡ä»¤&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;åŒæ ·ç”¨gdbæ¥è§‚å¯Ÿ&lt;/p&gt;

&lt;p class=&quot;info&quot;&gt;ğŸ“Œ ä½¿ç”¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;starti&lt;/code&gt;æ¥ä½¿gdbæ‰§è¡Œç¬¬ä¸€æ¡æŒ‡ä»¤ï¼Œä½¿ç”¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;layout asm&lt;/code&gt;æ¥ä½¿gdbå±•ç¤ºæ±‡ç¼–ä»£ç &lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/JYYOS/lec1/binary.png&quot; alt=&quot;Image&quot; /&gt;
æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸æºä»£ç ä¸åŒçš„æ˜¯ï¼Œæ­¤æ—¶çŠ¶æ€æœºçš„è¿ç§»å˜æˆäº†ä¸€æ¡æ¡çš„æ±‡ç¼–æŒ‡ä»¤&lt;/p&gt;

&lt;p&gt;è¿™é‡Œè¦è®°ä½ä¸€ä¸ªäº‹å®ï¼šæ‰€æœ‰çš„æŒ‡ä»¤éƒ½åªèƒ½&lt;strong&gt;è®¡ç®—&lt;/strong&gt;ï¼Œåšä¸åˆ°å…¶ä»–çš„äº‹æƒ…ï¼ˆæ¯”å¦‚è®©ç¨‹åºåœæ­¢è¿è¡Œï¼‰&lt;/p&gt;

&lt;p&gt;äºæ˜¯å°±å¼•å‡ºäº†ç³»ç»Ÿè°ƒç”¨çš„æ¦‚å¿µï¼Œç³»ç»Ÿè°ƒç”¨å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æŒ‡ä»¤ï¼Œç¨‹åºå°†è‡ªå·±çš„çŠ¶æ€ï¼ˆRï¼ŒMï¼‰å®Œå…¨äº¤ç»™æ“ä½œç³»ç»Ÿéšæ„ä¿®æ”¹ï¼Œä»è€Œå®ç°ä¸æ“ä½œç³»ç»Ÿä¸­å…¶ä»–å¯¹è±¡çš„äº¤äº’&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;è¯»å†™æ–‡ä»¶/æ“ä½œç³»ç»ŸçŠ¶æ€ï¼ˆä¾‹å¦‚å°†æ–‡ä»¶å†…å®¹å†™å›Mï¼‰&lt;/li&gt;
  &lt;li&gt;æ”¹å˜ç¨‹åºçŠ¶æ€ï¼ˆä¾‹å¦‚é€€å‡ºç¨‹åºï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å› æ­¤&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;ç¨‹åº&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;è®¡ç®—&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;syscall&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;é—®é¢˜æ„å»ºä¸€ä¸ªæœ€å°çš„hello-worldç¨‹åº&quot;&gt;é—®é¢˜ï¼šæ„å»ºä¸€ä¸ªæœ€å°çš„Hello Worldç¨‹åº&lt;/h3&gt;
&lt;h4 id=&quot;naive-approach&quot;&gt;Naive approach&lt;/h4&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#include &amp;lt;stdio.h&amp;gt;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Hello, World&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è¿™ä¸ªç¨‹åºæ˜¯å¦çœŸçš„å¤Ÿå°å‘¢ï¼Ÿå½“æˆ‘ä»¬ä½¿ç”¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gcc --verbose&lt;/code&gt;æŸ¥çœ‹gccçš„å®Œæ•´ç¼–è¯‘é€‰é¡¹æ—¶ï¼Œä¼šå‘ç°å…¶å®æœ‰å¾ˆå¤šå¾ˆå¤šçš„é€‰é¡¹ã€‚å†ä½¿ç”¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;size&lt;/code&gt;æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„å¤§å°ï¼Œä¼šå‘ç°æœ‰2000+å­—èŠ‚&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;âœ&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;out&lt;/span&gt;
   &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;	   &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;	    &lt;span class=&quot;n&quot;&gt;bss&lt;/span&gt;	    &lt;span class=&quot;n&quot;&gt;dec&lt;/span&gt;	    &lt;span class=&quot;n&quot;&gt;hex&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;
   &lt;span class=&quot;mi&quot;&gt;1566&lt;/span&gt;	    &lt;span class=&quot;mi&quot;&gt;600&lt;/span&gt;	      &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;	   &lt;span class=&quot;mi&quot;&gt;2174&lt;/span&gt;	    &lt;span class=&quot;mi&quot;&gt;87&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;out&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å¦‚æœæˆ‘ä»¬ä½¿ç”¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gcc -static&lt;/code&gt;é™æ€ç¼–è¯‘è¿™ä¸ªç¨‹åºï¼Œä¼šå‘ç°å¤§å°è¿œè¿œè¶…ä¹æˆ‘ä»¬çš„æƒ³è±¡&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;âœ&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;out&lt;/span&gt;
   &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;	   &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;	    &lt;span class=&quot;n&quot;&gt;bss&lt;/span&gt;	    &lt;span class=&quot;n&quot;&gt;dec&lt;/span&gt;	    &lt;span class=&quot;n&quot;&gt;hex&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;
 &lt;span class=&quot;mi&quot;&gt;762417&lt;/span&gt;	  &lt;span class=&quot;mi&quot;&gt;20804&lt;/span&gt;	   &lt;span class=&quot;mi&quot;&gt;6016&lt;/span&gt;	 &lt;span class=&quot;mi&quot;&gt;789237&lt;/span&gt;	  &lt;span class=&quot;n&quot;&gt;c0af5&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;out&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;å¼ºè¡Œç¼–è¯‘é“¾æ¥&quot;&gt;å¼ºè¡Œç¼–è¯‘+é“¾æ¥&lt;/h4&gt;
&lt;p class=&quot;info&quot;&gt;ğŸ“Œ ä½¿ç”¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gcc -c&lt;/code&gt;ä»…è¿›è¡Œç¼–è¯‘&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/JYYOS/lec1/compile-and-link.png&quot; alt=&quot;Image&quot; /&gt;
æˆ‘ä»¬ä¼šå‘ç°ï¼Œldæ‰¾ä¸åˆ°åº“å‡½æ•°ï¼Œè¿™æ˜¯å½“ç„¶çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰æŠŠ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/code&gt;ç¼–è¯‘è¿›æ¥ï¼Œè¿˜æœ‰ä¸€ä¸ªå¥‡æ€ªçš„warningè¯´æ‰¾ä¸åˆ°å…¥å£&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_start&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;é‚£ä¹ˆæˆ‘ä»¬è¯•è¯•ä¸è°ƒç”¨åº“å‡½æ•°ï¼Œå¹¶å°†&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;main&lt;/code&gt;æ”¹åä¸º&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;_start&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è¿™æ¬¡ç¡®å®æ²¡æœ‰æŠ¥é”™äº†ï¼Œè¡¨ç¤ºå·²ç»ç¼–è¯‘æˆåŠŸäº†ï¼Œä½†å½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼š&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;    &lt;span class=&quot;mi&quot;&gt;1178117&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;segmentation&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fault&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;core&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dumped&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;out&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬ç”¨gdbçœ‹çœ‹ä¸ºä»€ä¹ˆä¼šå‡ºç°æ®µé”™è¯¯ï¼Œå½“æˆ‘ä»¬è¿›è¡Œå•æ­¥è°ƒè¯•åæˆ‘ä»¬ä¼šå‘ç°ï¼Œç¨‹åºç›´åˆ°æ‰§è¡Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;retq&lt;/code&gt;ä¹‹å‰éƒ½æ­£å¸¸ï¼Œä½†è¿”å›åå°±å´©æºƒäº†
&lt;img src=&quot;/assets/images/JYYOS/lec1/retq.png&quot; alt=&quot;Image&quot; /&gt;
è¿™æ—¶éœ€è¦å¤ä¹ ä¸€ä¸‹å‡½æ•°è°ƒç”¨çš„å®ç°ä»¥åŠ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;retq&lt;/code&gt;æŒ‡ä»¤åšäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬å†™ä¸€ä¸ªç®€å•çš„ç¨‹åºæ¥çœ‹ä¸€ä¸‹&lt;/p&gt;

&lt;p class=&quot;info&quot;&gt;ğŸ“Œ ä½¿ç”¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;objdump -d&lt;/code&gt;æŸ¥çœ‹ç¨‹åºçš„æ±‡ç¼–ä»£ç &lt;/p&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gcc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;objdump&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;o&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;o&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;file&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mach&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;o&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bit&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x86&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;64&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;Disassembly&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;section&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__TEXT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;__text:

&lt;/span&gt;&lt;span class=&quot;mo&quot;&gt;0000000000000000&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
       &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;55&lt;/span&gt;                           	&lt;span class=&quot;n&quot;&gt;pushq&lt;/span&gt;	&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rbp&lt;/span&gt;
       &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;48&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;89&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e5&lt;/span&gt;                     	&lt;span class=&quot;n&quot;&gt;movq&lt;/span&gt;	&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rbp&lt;/span&gt;
       &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;                           	&lt;span class=&quot;n&quot;&gt;popq&lt;/span&gt;	&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rbp&lt;/span&gt;
       &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c3&lt;/span&gt;                           	&lt;span class=&quot;n&quot;&gt;retq&lt;/span&gt;
       &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;66&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;e&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;84&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;nopw&lt;/span&gt;	&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rax&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;mo&quot;&gt;0000000000000010&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_bar&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;55&lt;/span&gt;                           	&lt;span class=&quot;n&quot;&gt;pushq&lt;/span&gt;	&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rbp&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;48&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;89&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e5&lt;/span&gt;                     	&lt;span class=&quot;n&quot;&gt;movq&lt;/span&gt;	&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rbp&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;48&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;83&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ec&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;                  	&lt;span class=&quot;n&quot;&gt;subq&lt;/span&gt;	&lt;span class=&quot;vg&quot;&gt;$16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsp&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c7&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;45&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fc&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;01&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt;         	&lt;span class=&quot;n&quot;&gt;movl&lt;/span&gt;	&lt;span class=&quot;vg&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rbp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;f: &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c7&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;45&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f8&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;02&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt;         	&lt;span class=&quot;n&quot;&gt;movl&lt;/span&gt;	&lt;span class=&quot;vg&quot;&gt;$2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rbp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;26&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e8&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt;               	&lt;span class=&quot;n&quot;&gt;callq&lt;/span&gt;	&lt;span class=&quot;mh&quot;&gt;0x2b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_bar&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x1b&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;b: &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c7&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;45&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f4&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;03&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt;         	&lt;span class=&quot;n&quot;&gt;movl&lt;/span&gt;	&lt;span class=&quot;vg&quot;&gt;$3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rbp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c7&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;45&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f0&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;04&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt;         	&lt;span class=&quot;n&quot;&gt;movl&lt;/span&gt;	&lt;span class=&quot;vg&quot;&gt;$4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rbp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;39&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;48&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;83&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c4&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;                  	&lt;span class=&quot;n&quot;&gt;addq&lt;/span&gt;	&lt;span class=&quot;vg&quot;&gt;$16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsp&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;d: &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;                           	&lt;span class=&quot;n&quot;&gt;popq&lt;/span&gt;	&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rbp&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;e: &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c3&lt;/span&gt;                           	&lt;span class=&quot;n&quot;&gt;retq&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;f: &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;90&lt;/span&gt;                           	&lt;span class=&quot;n&quot;&gt;nop&lt;/span&gt;

&lt;span class=&quot;mo&quot;&gt;0000000000000040&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;55&lt;/span&gt;                           	&lt;span class=&quot;n&quot;&gt;pushq&lt;/span&gt;	&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rbp&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;41&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;48&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;89&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e5&lt;/span&gt;                     	&lt;span class=&quot;n&quot;&gt;movq&lt;/span&gt;	&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rbp&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;44&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;e8&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;00&lt;/span&gt;               	&lt;span class=&quot;n&quot;&gt;callq&lt;/span&gt;	&lt;span class=&quot;mh&quot;&gt;0x49&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_foo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x9&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;49&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;                           	&lt;span class=&quot;n&quot;&gt;popq&lt;/span&gt;	&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rbp&lt;/span&gt;
      &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;a: &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c3&lt;/span&gt;                           	&lt;span class=&quot;n&quot;&gt;retq&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å‡½æ•°è°ƒç”¨çš„å…¨è¿‡ç¨‹ï¼ˆ&lt;strong&gt;æ³¨æ„æ ˆæ˜¯å‘ä¸‹ç”Ÿé•¿çš„ï¼Œå› æ­¤é«˜åœ°å€ä¸ºåº•éƒ¨ï¼Œä½åœ°å€ä¸ºé¡¶éƒ¨&lt;/strong&gt;ï¼‰&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;æ‰§è¡Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;callq&lt;/code&gt;æŒ‡ä»¤ï¼šæ­¤æ—¶ä¼šå°†&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rip&lt;/code&gt;çš„å€¼å…¥æ ˆï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rip&lt;/code&gt;æ­¤æ—¶æŒ‡å‘&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;callq&lt;/code&gt;çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯å°†æ¥å‡½æ•°è°ƒç”¨è¿”å›æ—¶çš„åœ°å€ã€‚ç„¶åè·³è½¬åˆ°å¯¹åº”å‡½æ•°çš„èµ·å§‹ä½ç½®&lt;/li&gt;
  &lt;li&gt;å°†&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rbp&lt;/code&gt;å…¥æ ˆï¼šæ­¤æ—¶&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rsp&lt;/code&gt;ä¸‹ç§»8ä¸ªå­—èŠ‚ï¼Œå¹¶åœ¨å¯¹åº”ä½ç½®ä¿å­˜&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rbp&lt;/code&gt;çš„å€¼ï¼Œè¿™æ˜¯è°ƒç”¨å‡½æ•°å‰çš„æ ˆåº•åœ°å€&lt;/li&gt;
  &lt;li&gt;å°†&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rsp&lt;/code&gt;çš„å€¼èµ‹ç»™&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rbp&lt;/code&gt;ï¼Œç»è¿‡è¿™ä¸€æ­¥åï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rbp&lt;/code&gt;ä¼šæŒ‡å‘æ–°æ ˆçš„æ ˆåº•ï¼Œé‡Œé¢ä¿å­˜ç€è¿”å›ä¸Šä¸€ä¸ªæ ˆåº•åœ°å€&lt;/li&gt;
  &lt;li&gt;å°†&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rsp&lt;/code&gt;ä¸‹ç§»ï¼Œä½¿å…¶æŒ‡å‘æ–°æ ˆçš„æ ˆé¡¶&lt;/li&gt;
  &lt;li&gt;å±€éƒ¨å˜é‡å…¥æ ˆï¼Œæ‰§è¡Œå‡½æ•°ä½“&lt;/li&gt;
  &lt;li&gt;å°†&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rsp&lt;/code&gt;ä¸Šç§»ï¼Œä½¿å…¶å›åˆ°æ ˆåº•çš„ä½ç½®&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rbp&lt;/code&gt;å‡ºæ ˆï¼šæ­¤æ—¶å…ˆå–å‡º&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rsp&lt;/code&gt;å¤„ä¿å­˜çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯åŸæ¥çš„æ ˆåº•åœ°å€ï¼‰ï¼Œå¹¶èµ‹ç»™&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rbp&lt;/code&gt;ï¼Œæ­¤æ—¶&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rbp&lt;/code&gt;é‡æ–°æŒ‡å‘è°ƒç”¨å‡½æ•°å‰çš„æ ˆåº•ã€‚ç„¶åå°†&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rsp&lt;/code&gt;ä¸Šç§»8ä¸ªå­—èŠ‚ï¼Œæ­¤æ—¶&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rsp&lt;/code&gt;æŒ‡å‘&lt;strong&gt;å‡½æ•°è¿”å›åçš„ä¸‹ä¸€æ¡æŒ‡ä»¤&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;æ‰§è¡Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;retq&lt;/code&gt;ï¼š
    &lt;ol&gt;
      &lt;li&gt;å°†pcç§»åŠ¨åˆ°å‡½æ•°è¿”å›åçš„ä¸‹ä¸€æ¡æŒ‡ä»¤ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mov (%rsp), rip&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsp&lt;/code&gt;é‡æ–°æŒ‡å‘è°ƒç”¨å‡½æ•°å‰çš„æ ˆé¡¶ &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mov rsp, rsp + 8&lt;/code&gt;&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;ç¤ºæ„å›¾ï¼š
&lt;img src=&quot;/assets/images/JYYOS/lec1/stack.png&quot; alt=&quot;Image&quot; /&gt;
ä»å›¾ä¸­æˆ‘ä»¬è¿˜èƒ½å‘ç°ï¼Œæ¯ä¸ªæ ˆå¸§é¡¶éƒ¨ä¿å­˜çš„å°±æ˜¯ä¸‹ä¸€ä¸ªæ ˆå¸§é‡Šæ”¾æ—¶ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rip&lt;/code&gt;è¦è·³è½¬çš„åœ°å€ï¼Œä¹Ÿå³å‡½æ•°çš„è¿”å›åœ°å€&lt;/p&gt;

&lt;p&gt;å›åˆ°åˆšæ‰å‘ç”Ÿæ®µå¼‚å¸¸çš„åœ°æ–¹ï¼Œæ—¢ç„¶&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;retq&lt;/code&gt;å‡ºé”™äº†ï¼Œé‚£ä¹ˆè¦ä¹ˆæ˜¯å–&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rsp&lt;/code&gt;çš„æ—¶å€™å‡ºé”™ï¼Œè¦ä¹ˆæ˜¯æ›´æ–°&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rsp&lt;/code&gt;çš„å€¼å‡ºé”™ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥è°ƒè¯•
&lt;img src=&quot;/assets/images/JYYOS/lec1/$rsp.png&quot; alt=&quot;Image&quot; /&gt;
ä¼šå‘ç°æ­¤æ—¶&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%rsp&lt;/code&gt;ä¿å­˜çš„å€¼ä¸º0x1ï¼Œä¸æ˜¯ä¸€ä¸ªåˆæ³•åœ°å€ï¼Œæ‰€ä»¥&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;retq&lt;/code&gt;å°±ä¼šè®¿é—®å¼‚å¸¸äº†ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;syscall&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;syscall&quot;&gt;syscall&lt;/h4&gt;
&lt;p&gt;ç›´æ¥ä¸Šä»£ç &lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;#include &amp;lt;sys/syscall.h&amp;gt;&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;global&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_start&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;_start:
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;movq&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;$SYS_write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rax&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# write(&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;movq&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;         &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rdi&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;#  fd = 1,&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;movq&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;$st&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;        &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rsi&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;#  buf = st,&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;movq&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;st&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rdx&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;#  length = ed - st&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;syscall&lt;/span&gt;                &lt;span class=&quot;c1&quot;&gt;# );&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;movq&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;$SYS_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rax&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;# exit(&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;movq&lt;/span&gt; &lt;span class=&quot;vg&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;         &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rdi&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;#  1&lt;/span&gt;
  &lt;span class=&quot;nb&quot;&gt;syscall&lt;/span&gt;                &lt;span class=&quot;c1&quot;&gt;# );&lt;/span&gt;

&lt;span class=&quot;ss&quot;&gt;st:
  &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ascii&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;[31;44mHello, World&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;ed:
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;è¿™æ˜¯ä¸€æ®µæ±‡ç¼–ä»£ç ï¼Œåˆ†åˆ«è°ƒç”¨äº†å¦‚ä¸‹ä¸¤æ¡ç³»ç»Ÿè°ƒç”¨ï¼š&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;syscall&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;SYS_write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;[31;44mHello, World&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\033&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;[31;44mHello, World&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;syscall&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;SYS_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æ‰“å°çš„æ•ˆæœå¦‚å›¾&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/JYYOS/lec1/hello-world.png&quot; alt=&quot;Image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;è¿™é‡Œçš„å°å½©è›‹å°±æ˜¯ç”¨äº†&lt;a href=&quot;https://www.ing.iac.es/~docs/external/bash/abs-guide/colorizing.html&quot;&gt;ANSI Escape Code&lt;/a&gt;æ¥æ§åˆ¶æ‰“å°å‡ºæ¥çš„Hello Worldçš„æ ·å¼ã€‚åŒæ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªç¨‹åºæ˜¯å¾ˆå°çš„&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;âœ&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;out&lt;/span&gt;
   &lt;span class=&quot;n&quot;&gt;text&lt;/span&gt;	   &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;	    &lt;span class=&quot;n&quot;&gt;bss&lt;/span&gt;	    &lt;span class=&quot;n&quot;&gt;dec&lt;/span&gt;	    &lt;span class=&quot;n&quot;&gt;hex&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;
     &lt;span class=&quot;mi&quot;&gt;67&lt;/span&gt;	      &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;	      &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;	     &lt;span class=&quot;mi&quot;&gt;67&lt;/span&gt;	     &lt;span class=&quot;mi&quot;&gt;43&lt;/span&gt;	&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;out&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;å¦‚ä½•åœ¨ä¸¤ä¸ªè§†è§’é—´åˆ‡æ¢&quot;&gt;å¦‚ä½•åœ¨ä¸¤ä¸ªè§†è§’é—´åˆ‡æ¢&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨ç¼–è¯‘å™¨ã€‚ç¼–è¯‘å™¨å°±æ˜¯è‡ªåŠ¨å°†æºä»£ç è½¬åŒ–æˆæ±‡ç¼–ä»£ç çš„å·¥å…·&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;C&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Assemble&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;code&lt;/span&gt;
&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Source&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;code&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;C&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Compiler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ä½•è°“æ­£ç¡®çš„ç¼–è¯‘å™¨å‘¢ï¼Ÿä¿è¯Så’ŒCçš„è¡Œä¸ºå®Œå…¨ä¸€è‡´ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä¸€ä¸ªç¼–è¯‘å™¨å®Œå…¨æŒ‰ç…§æºä»£ç è¿›è¡Œè§£é‡Šæ€§ç¼–è¯‘ï¼Œé‚£ä¹ˆå…¶è¯­ä¹‰ä¸€å®šä¸æºä»£ç ç›¸åŒã€‚ä½†ç°ä»£ç¼–è¯‘å™¨éƒ½å…·å¤‡ä¼˜åŒ–åŠŸèƒ½ï¼Œä¼šè¿›è¡Œå¤§é‡çš„ä¼˜åŒ–ï¼Œä¾‹å¦‚æŒ‡ä»¤é‡æ’ï¼Œåˆ é™¤ä¸å¿…è¦çš„æŒ‡ä»¤ç­‰ç­‰&lt;/p&gt;

&lt;h2 id=&quot;æ“ä½œç³»ç»Ÿä¸­çš„ä¸€èˆ¬ç¨‹åº&quot;&gt;æ“ä½œç³»ç»Ÿä¸­çš„ä¸€èˆ¬ç¨‹åº&lt;/h2&gt;
&lt;p&gt;æ‰€æœ‰ç¨‹åºä¸å‰è¿°çš„æœ€å°çš„Hello Worldç¨‹åºæœ¬è´¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œç­‰äºè®¡ç®—+ç³»ç»Ÿè°ƒç”¨ã€‚æ“ä½œç³»ç»Ÿç®¡ç†äº†æ‰€æœ‰çš„è½¯ç¡¬ä»¶èµ„æºï¼Œå¯¹ç¨‹åºæ¥è¯´æ“ä½œç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªæ¥å£ï¼Œç¨‹åºå¯ä»¥ä»ä¸­æ‹¿å„ç§ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥è¯·æ±‚å®Œæˆä¸€äº›æ“ä½œ&lt;/p&gt;

&lt;p&gt;ç¨‹åºä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿä¸­çš„å¯¹è±¡ï¼Œä¸æ–‡æœ¬æ–‡ä»¶æœ¬è´¨ç›¸åŒï¼Œåªä¸è¿‡æ˜¯äºŒè¿›åˆ¶çš„ï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vim&lt;/code&gt;æ— æ³•æ­£ç¡®æ˜¾ç¤ºï¼Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;xxd&lt;/code&gt;å¯ä»¥çœ‹åˆ°&lt;/p&gt;

&lt;p&gt;å¦‚ä½•å¾—çŸ¥ç¨‹åºçš„åˆå§‹çŠ¶æ€ï¼Ÿä½¿ç”¨gdb&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/JYYOS/lec1/initial-state.png&quot; alt=&quot;Image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;ä»å›¾ä¸­èƒ½çœ‹åˆ°ï¼Œç¬¬ä¸€æ¡æŒ‡ä»¤ä½äº&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x00007ffff7fd0100&lt;/code&gt;ï¼Œå…¶å®æ˜¯linuxçš„åŠ è½½å™¨ã€‚é«˜åœ°å€åŒºåŸŸéƒ½æ˜¯æ“ä½œç³»ç»Ÿæ˜ å°„çš„ï¼Œè€Œä½åœ°å€åŒºåˆ™æ˜¯ç¨‹åºæœ¬èº«çš„ç©ºé—´&lt;/p&gt;

&lt;p&gt;æ—¢ç„¶ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹æœ‰ç€ç¡®å®šçš„æœºåˆ¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨ç›¸åº”çš„å·¥å…·æ¥è¿›è¡Œè§‚æµ‹ã€‚&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;strace&lt;/code&gt;å¯ä»¥æ‰“å°å‡ºä¸€ä¸ªç¨‹åºä½¿ç”¨çš„æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/JYYOS/lec1/strace.png&quot; alt=&quot;Image&quot; /&gt;&lt;/p&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°æ¯ä¸ªç¨‹åºæ‰§è¡Œçš„ç¬¬ä¸€æ¡ç³»ç»Ÿè°ƒç”¨ä¸€å®šæ˜¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;exec&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;æ€»ç»“&quot;&gt;æ€»ç»“&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;ç¨‹åº = çŠ¶æ€æœº
    &lt;ul&gt;
      &lt;li&gt;æºä»£ç Sï¼šçŠ¶æ€è¿ç§» = æ‰§è¡Œè¯­å¥&lt;/li&gt;
      &lt;li&gt;äºŒè¿›åˆ¶ä»£ç Cï¼šçŠ¶æ€è¿ç§» = æ‰§è¡ŒæŒ‡ä»¤&lt;/li&gt;
      &lt;li&gt;ç¼–è¯‘å™¨ C = Compiler(S)&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åº”ç”¨è§†è§’çš„æ“ä½œç³»ç»Ÿï¼šsyscall&lt;/li&gt;
  &lt;li&gt;è®¡ç®—æœºç³»ç»Ÿæ²¡æœ‰é­”æ³•ï¼ˆä¸å­˜åœ¨ç„å­¦ï¼‰ï¼Œä¸€åˆ‡éƒ½å»ºç«‹åœ¨ç¡®å®šçš„æœºåˆ¶ä¸Š
    &lt;ul&gt;
      &lt;li&gt;ä½ çš„æ­¦å™¨ï¼šgcc, &lt;a href=&quot;https://sourceware.org/gdb/current/onlinedocs/gdb.html/&quot;&gt;gdb&lt;/a&gt;, &lt;a href=&quot;https://www.gnu.org/software/binutils/&quot;&gt;binutils&lt;/a&gt;, straceâ€¦&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;</content><author><name>CY</name></author><category term="OS_Learning" /><summary type="html"></summary></entry><entry><title type="html">A simple ATM implementation based on message queue</title><link href="/2023/02/03/ATM.html" rel="alternate" type="text/html" title="A simple ATM implementation based on message queue" /><published>2023-02-03T00:00:00+08:00</published><updated>2023-02-03T00:00:00+08:00</updated><id>/2023/02/03/ATM</id><content type="html" xml:base="/2023/02/03/ATM.html">&lt;!--more--&gt;
&lt;p&gt;å¯¹ã€ŠC++ Concurrency In Actionã€‹ç¬¬4.4.2éƒ¨åˆ†çš„ä¸€ä¸ªè®°å½•ï¼Œä¸»è¦ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ¥å®ç°çº¿ç¨‹é—´çš„äº¤äº’ã€‚è¿™ç§åšæ³•å«åšCommunicating Sequential Processesï¼Œç®€ç§°CSPï¼Œå…¶æ€è·¯å°±æ˜¯å¦‚æœçº¿ç¨‹é—´æ²¡æœ‰å…±äº«çš„æ•°æ®é‚£ä¹ˆåˆ†æèµ·æ¥å°±ä¼šç®€å•å¾ˆå¤šï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘æ¯ä¸ªçº¿ç¨‹åœ¨æ”¶åˆ°ç‰¹å®šçš„æ¶ˆæ¯æ—¶çš„è¡Œä¸ºå³å¯ï¼Œæ¯ä¸ªçº¿ç¨‹å¯ä»¥è§†ä½œä¸€ä¸ªæœ‰é™çŠ¶æ€æœº&lt;/p&gt;

&lt;h3 id=&quot;atmæœºçš„å®ç°æ€è·¯&quot;&gt;ATMæœºçš„å®ç°æ€è·¯&lt;/h3&gt;
&lt;p&gt;ç°åœ¨æ€è€ƒä¸€ä¸‹ATMæœºçš„å·¥ä½œæµç¨‹ï¼Œåˆå§‹çŠ¶æ€ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œå½“æ’å…¥é“¶è¡Œå¡åä¼šè¿›å…¥è¾“å…¥å¯†ç çš„ç¯èŠ‚ï¼Œæ­¤æ—¶å¯ä»¥è¾“å…¥å¯†ç ã€å›é€€æˆ–æ˜¯å–æ¶ˆã€‚å½“è¾“å…¥6ä¸ªæ•°å­—åè¿›è¡Œå¯†ç æ ¡éªŒï¼Œå¦‚æœæˆåŠŸåˆ™è¿›å…¥è´¦æˆ·é¡µé¢ã€‚è´¦æˆ·é¡µé¢å¯ä»¥å–æ¬¾ã€æŸ¥è¯¢ä½™é¢ï¼Œå–æ¬¾æ—¶éœ€è¦è¾“å…¥é‡‘é¢å¹¶å‘é“¶è¡Œç¡®è®¤äº¤æ˜“ç»“æœï¼ŒæˆåŠŸåˆ™æœºå™¨å–å‡ºå¯¹åº”çš„é’ç¥¨ï¼Œå¦åˆ™æç¤ºå¤±è´¥ã€‚æ€»ä½“ä¸Šæ¥çœ‹æˆ‘ä»¬å¯ä»¥åˆ†æˆä¸‰ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;é€»è¾‘çº¿ç¨‹ï¼šå¤„ç†ç”¨æˆ·è¾“å…¥ã€çŠ¶æ€æµè½¬&lt;/li&gt;
  &lt;li&gt;ç¡¬ä»¶çº¿ç¨‹ï¼šå±•ç¤ºå¯¹åº”ä¿¡æ¯ã€æå–ç°é‡‘&lt;/li&gt;
  &lt;li&gt;é“¶è¡Œçº¿ç¨‹ï¼šæ ¡éªŒå¯†ç å’Œä½™é¢æƒ…å†µ&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;æµç¨‹å›¾&quot;&gt;æµç¨‹å›¾&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/assets/images/ATM.png&quot; alt=&quot;Image&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;å…·ä½“å®ç°&quot;&gt;å…·ä½“å®ç°&lt;/h3&gt;
&lt;p&gt;é¦–å…ˆå®ç°ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—çš„æ¨¡å‹ï¼Œæ”¯æŒä»»æ„ç±»å‹çš„æ¶ˆæ¯&lt;/p&gt;
&lt;h4 id=&quot;messageç±»&quot;&gt;Messageç±»&lt;/h4&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;åŸºç±»&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;MessageBase&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;public:
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;virtual&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MessageBase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;åŒ…è£…ç±»ï¼Œæ¨¡æ¿å‚æ•°æŒ‡å®šæ¶ˆæ¯ç±»å‹&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WrapperMessage&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;MessageBase&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;public:
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;explicit&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WrapperMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;Message&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;messagequeueç±»&quot;&gt;MessageQueueç±»&lt;/h4&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ä½¿ç”¨äº’æ–¥é”å’Œæ¡ä»¶å˜é‡ç®¡ç†çš„æ¶ˆæ¯é˜Ÿåˆ—&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MessageQueue&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;public:
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lock_guard&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mutex&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;make_shared&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;WrapperMessage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cv_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;notify_all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shared_ptr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MessageBase&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WaitAndPop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unique_lock&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mutex&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;l&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;m_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cv_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;wait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;empty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;front&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;ss&quot;&gt;private:
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shared_ptr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MessageBase&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;condition_variable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cv_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mutex&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;senderå’Œreceiverç±»&quot;&gt;Senderå’ŒReceiverç±»&lt;/h4&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Sender&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ç±»å¼•ç”¨ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶å‘å…¶æ¨é€è‡ªå®šä¹‰æ¶ˆæ¯&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Sender&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;public:
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;explicit&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MessageQueue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;ss&quot;&gt;private:
  &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MessageQueue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nullptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Receiver&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ç±»æŒæœ‰ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œåˆ›å»º&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Dispatcher&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ç±»æ¥å¤„ç†å…¶ä¸­çš„æ¶ˆæ¯ã€‚æ”¯æŒè½¬åŒ–ä¸º&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Sender&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;æ¥åˆ©ç”¨å…¶ä¸­çš„é˜Ÿåˆ—å‘é€æ¶ˆæ¯&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Receiver&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;public:
  &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Dispatcher&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;operator&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;ss&quot;&gt;private:
  &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MessageQueue&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;dispatcherç±»&quot;&gt;Dispatcherç±»&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dispatcher&lt;/code&gt;ç±»æ˜¯ä¸€ä¸ªä¸“é—¨è´Ÿè´£åˆ†å‘æ¶ˆæ¯çš„ç±»ï¼Œå½“å®ƒææ„æ—¶å®ƒä¼šå°è¯•å°†å¯¹åº”é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„æ¶ˆæ¯åˆ†å‘å‡ºå»ã€‚è¿™å…¶å®åªæ˜¯ä¸€ä¸ªå…œåº•æ“ä½œï¼Œå¤§å¤šæ•°æƒ…å†µæ˜¯é€šè¿‡è°ƒç”¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Handle&lt;/code&gt;å‡½æ•°æ¥å¤„ç†ç‰¹å®šçš„æ¶ˆæ¯ã€‚æ³¨æ„è¿™é‡Œçš„&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chained_&lt;/code&gt;æˆå‘˜å˜é‡ç”¨æ¥æ ‡è®°è¿™ä¸ªDispatcheræ˜¯ä¸æ˜¯å·²ç»â€œé“¾â€è¿›å»äº†ï¼Œä¸»è¦æ˜¯é¿å…é‡å¤è¿›è¡Œåˆ†å‘ã€‚åœ¨å®ç°ä¸­æˆ‘ä»¬å°†&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dispatcher&lt;/code&gt;ä¸€ä¸ªä¸ªé“¾èµ·æ¥å¤„ç†æ¶ˆæ¯çš„æ—¶å€™ä¼šçœ‹çš„æ›´æ¸…æ¥š
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TemplateDispatcher&lt;/code&gt;å’Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dispatcher&lt;/code&gt;ç±»å‡ ä¹ä¸€æ ·ï¼Œä½†æ˜¯å¢åŠ äº†å¤„ç†çš„Messageå’ŒFuncä½œä¸ºæ¨¡æ¿å‚æ•°&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CloseQueue&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{};&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Dispatcher&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;public:
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;explicit&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MessageQueue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;Dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Dispatcher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chained_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;chained_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;chained_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;noexcept&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chained_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;no&quot;&gt;WaitAndDispatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;no&quot;&gt;Dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Dispatcher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;Dispatcher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;operator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Dispatcher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;template&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Func&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;friend&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TemplateDispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Func&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;TemplateDispatcher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Func&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Func&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;TemplateDispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;forward&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Func&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Dispatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shared_ptr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MessageBase&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dynamic_cast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;WrapperMessage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;CloseQueue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;*&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kp&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CloseQueue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;ss&quot;&gt;private:
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WaitAndDispatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(;;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;WaitAndPop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;no&quot;&gt;Dispatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;ss&quot;&gt;private:
  &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MessageQueue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nullptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chained_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PreviousDispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Func&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TemplateDispatcher&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;public:
  &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;TemplateDispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MessageQueue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PreviousDispatcher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;previous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Func&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chained_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;previous&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chained_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;previous_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;previous&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;forward&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Func&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;previous&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chained_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;no&quot;&gt;TemplateDispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;TemplateDispatcher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chained_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;chained_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;previous_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;previous_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;move&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;f_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;chained_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;no&quot;&gt;TemplateDispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;TemplateDispatcher&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;TemplateDispatcher&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;operator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;TemplateDispatcher&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;other&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;template&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Dispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OtherMsg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OtherFunc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;friend&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TemplateDispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  
  &lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OtherMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OtherFunc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;TemplateDispatcher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;TemplateDispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OtherMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OtherFunc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;OtherFunc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;TemplateDispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;forward&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;OtherFunc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;TemplateDispatcher&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;noexcept&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chained_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;no&quot;&gt;WaitAndDispatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;n&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Dispatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;shared_ptr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MessageBase&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wrapper_message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dynamic_cast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;WrapperMessage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;*&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;f_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wrapper_message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;previous_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Dispatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;ss&quot;&gt;private:
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;WaitAndDispatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(;;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;WaitAndPop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Dispatch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;ss&quot;&gt;private:
  &lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MessageQueue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nullptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;chained_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;PreviousDispatcher&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;previous_&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nullptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;Func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Dispatcherä½¿ç”¨å®ä¾‹ï¼š&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;Receiver&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;receiver&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;receiver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Handle&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Message1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([](&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Message1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
  &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Do&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;something&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Handle&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Message2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([](&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Message2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
  &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Do&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;something&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;è¿‡ç¨‹åˆ†æï¼š&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;è°ƒç”¨è¿™è¡Œä»£ç æ—¶ä¼šåˆ›å»ºè‹¥å¹²ä¸ª&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dispatcher&lt;/code&gt;å’Œ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TemplateDispatcher&lt;/code&gt;å¯¹è±¡ï¼Œå®ƒä»¬å¼•ç”¨åŒä¸€ä¸ª&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MessageQueue&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;æ‰§è¡Œå®Œè¿™æ¡è¯­å¥åï¼Œä»åå‘å‰ä¾æ¬¡è°ƒç”¨æ¯ä¸ªå¯¹è±¡çš„ææ„å‡½æ•°ï¼Œå¦‚æœé˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯åˆ™é˜»å¡åœ¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;WaitAndDispatch&lt;/code&gt;æ–¹æ³•ï¼Œå¦åˆ™å–å‡ºæ¶ˆæ¯åè¯•å›¾è¿›è¡Œåˆ†å‘ï¼Œå¦‚æœå½“å‰çš„&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dispatcher&lt;/code&gt;å¤„ç†ä¸äº†ï¼ˆæ¶ˆæ¯ç±»å‹ä¸åŒ¹é…ï¼‰å°±ç»§ç»­ä¼ é€’ç»™å‰ä¸€ä¸ªè¿›è¡Œå¤„ç†&lt;/li&gt;
  &lt;li&gt;å¦‚æœæŸæ¡æ¶ˆæ¯ç»è¿‡äº†å¤„ç†ï¼Œå°±ä»ææ„å‡½æ•°çš„æ— é™å¾ªç¯ä¸­é€€å‡ºã€‚ç”±äº&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;chained_&lt;/code&gt;å˜é‡çš„å­˜åœ¨ï¼Œè¿™æ¡æ¶ˆæ¯æœ€å¤šåªä¼šè¢«å¤„ç†ä¸€æ¬¡&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;å…¥å£ä»£ç &quot;&gt;å…¥å£ä»£ç &lt;/h4&gt;
&lt;p&gt;åœ¨å…·ä½“å®ç°çŠ¶æ€æœºå‰ï¼Œå¯ä»¥å…ˆå¤§è‡´å†™å‡ºå…¥å£ä»£ç &lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;æˆ‘ä»¬éœ€è¦ä¸‰ä¸ªå¯¹è±¡æ¥åˆ†åˆ«å¤„ç†ä¸»çŠ¶æ€æœºã€ç¡¬ä»¶ä»¥åŠé“¶è¡Œçš„é€»è¾‘&lt;/li&gt;
  &lt;li&gt;è¿™ä¸‰ä¸ªå¯¹è±¡åˆ†åˆ«åœ¨ä¸‰ä¸ªçº¿ç¨‹ä¸Šè¿›è¡Œå„è‡ªçš„å·¥ä½œ&lt;/li&gt;
  &lt;li&gt;å®ƒä»¬é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æ¥äº’ç›¸å‘é€æ¶ˆæ¯ã€‚ä¾‹å¦‚åˆå§‹çŠ¶æ€çŠ¶æ€æœºçº¿ç¨‹ç­‰å¾…æ’å…¥é“¶è¡Œå¡ï¼Œå½“æ’å…¥é“¶è¡Œå¡åç”±ç¡¬ä»¶çº¿ç¨‹è¾“å‡ºä¸€è¡Œæ¬¢è¿è¯­å¥ï¼Œæ¥ä¸‹æ¥ä¸»çº¿ç¨‹æ¥å—ç”¨æˆ·è¾“å…¥ï¼Œå¹¶å‘é€ç»™çŠ¶æ€æœºçº¿ç¨‹å¤„ç†ç›¸å…³é€»è¾‘ï¼Œè¾“å…¥å®Œæ¯•ååˆ™å‘é€ç»™é“¶è¡Œçº¿ç¨‹è¿›è¡Œæ ¡éªŒâ€¦â€¦&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;BankMachine&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bank_machine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;balance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;HardwareMachine&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hardware_machine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;ATMMachine&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;atm_machine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bank_machine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;GetSender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;hardware_machine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;GetSender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;messaging&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Sender&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;atm_machine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;GetSender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;());&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;atm_thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;ATMMachine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;atm_machine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bank_thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;BankMachine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bank_machine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;hardware_thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;HardwareMachine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Run&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hardware_machine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;atm_machine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;hardware_machine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;bank_machine&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;atm_thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;hardware_thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;bank_thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;å‰©ä¸‹çš„è¿‡ç¨‹å…¶å®å°±æ˜¯æ…¢æ…¢æ ¹æ®çŠ¶æ€æµè½¬å›¾å»å®Œå–„è¿™ä¸‰ä¸ªç±»äº†ï¼Œå…·ä½“ä»£ç è¿™é‡Œå°±ä¸è¯¦ç»†åˆ—å‡ºäº†ï¼Œå¯ä»¥ç›´æ¥åœ¨&lt;a href=&quot;https://github.com/mikucy/ATMDemo&quot;&gt;Githubä»“åº“&lt;/a&gt;æŸ¥çœ‹&lt;/p&gt;</content><author><name>CY</name></author><category term="Concurrency" /><summary type="html"></summary></entry><entry><title type="html">Understanding mutex</title><link href="/2023/01/11/Mutex.html" rel="alternate" type="text/html" title="Understanding mutex" /><published>2023-01-11T00:00:00+08:00</published><updated>2023-01-11T00:00:00+08:00</updated><id>/2023/01/11/Mutex</id><content type="html" xml:base="/2023/01/11/Mutex.html">&lt;!--more--&gt;

&lt;p&gt;è‡ªå·±ä¸€ç›´å¯¹äºmutexç†è§£çš„è¿˜æ˜¯å¾ˆç‰‡é¢ï¼Œè¿™ç¯‡æ–‡ç« è®°å½•ä¸€äº›å¿ƒå¾—ä»¥åŠç”¨æ³•æ¥åŠ æ·±å°è±¡&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;ä»€ä¹ˆæ˜¯mutex&quot;&gt;ä»€ä¹ˆæ˜¯mutex&lt;/h2&gt;
&lt;p&gt;mutexï¼Œå…¨ç§°æ˜¯&lt;strong&gt;mutual exclusion&lt;/strong&gt;ï¼Œä¹Ÿå°±æ˜¯äº’ç›¸æ’æ–¥çš„æ„æ€ï¼Œé€šå¸¸æˆ‘ä»¬ä¹Ÿä¼šç®€ç§°ä¸ºé”ã€‚mutexçš„ä½œç”¨å°±æ˜¯æä¾›äº’æ–¥è®¿é—®çš„ç‰¹æ€§ï¼Œä»è€Œåœ¨å¤šçº¿ç¨‹çš„ç¨‹åºä¸­é¿å…å› æ¡ä»¶ç«äº‰å¸¦æ¥çš„é—®é¢˜ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯çº¿ç¨‹åŒæ­¥çš„ä¸€ç§æœºåˆ¶ã€‚&lt;/p&gt;

&lt;p&gt;è™½ç„¶æ¦‚å¿µå¬èµ·æ¥é«˜å¤§ä¸Šï¼Œä½†å…¶å®mutexå¯ä»¥ç†è§£ä¸ºå°±æ˜¯å†…å­˜çš„ä¸€å—å€¼ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªè®¿é—®è¿™å—å†…å­˜çš„çº¿ç¨‹è¯»åˆ°çš„æ˜¯0ï¼ˆå¯ä»¥ä½¿ç”¨ï¼‰ï¼Œä¸€æ—¦å®ƒè¢«è·å–ï¼Œå…¶ä»–çº¿ç¨‹å†æ¬¡è®¿é—®è¯»åˆ°çš„å°±ä¼šæ˜¯1ï¼ˆæ— æ³•ä½¿ç”¨/ä½¿ç”¨ä¸­ï¼‰&lt;/p&gt;

&lt;h2 id=&quot;mutexçš„å®ç°&quot;&gt;mutexçš„å®ç°&lt;/h2&gt;
&lt;p&gt;å…³äºmutexçš„å®ç°æˆ‘ä¹‹å‰ä¸€ç›´å¾ˆæ¨¡ç³Šï¼Œä¸ç¡®å®šå®ƒåˆ°åº•æ˜¯è½¯ä»¶å®ç°çš„ï¼Œè¿˜æ˜¯æœ‰ç¡¬ä»¶æ”¯æŒã€‚é€ æˆè¿™ç§å°è±¡çš„åŸå› åº”è¯¥æ˜¯è‡ªå­¦æ“ä½œç³»ç»Ÿè¯¾ç¨‹æ—¶çŸ¥è¯†ç‚¹æ²¡æœ‰æ·±å…¥ç†è§£ã€‚è™½ç„¶å¾ˆæ—©æœŸDekkerå’ŒPetersonç¡®å®ç”¨è½¯ä»¶çš„æ–¹å¼å®ç°äº†é”ï¼Œä½†æ˜¯ç›¸å…³ç®—æ³•æ—¢éš¾ä»¥ç†è§£ï¼Œä¹Ÿå¾ˆéš¾åˆ¤æ–­è¡Œä¸ºæ˜¯å¦ç¬¦åˆé¢„æœŸã€‚å› æ­¤ç°ä»£çš„æ“ä½œç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯åœ¨ç°ä»Šå¤šæ ¸CPUå·²ç»éå¸¸æ™®åŠçš„æƒ…å†µä¸‹ï¼Œ&lt;strong&gt;mutexéƒ½æ˜¯æœ‰ç¡¬ä»¶æ”¯æŒæ¥å®ç°çš„&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ç”¨å¤šç§æ–¹å¼æ¥å®ç°è‡ªæ—‹é”&quot;&gt;ç”¨å¤šç§æ–¹å¼æ¥å®ç°è‡ªæ—‹é”&lt;/h3&gt;
&lt;p&gt;è‡ªæ—‹é”æ˜¯é”çš„ä¸€ç§ï¼Œå…¶ç‰¹å¾å°±æ˜¯å¦‚æœè·å–é”å¤±è´¥äº†åˆ™ä¼šä¸€ç›´ç­‰å¾…ç›´åˆ°è·å¾—é”ã€‚åˆ©ç”¨ç°ä»£è®¡ç®—æœºç¡¬ä»¶æä¾›çš„ä¸€äº›æŒ‡ä»¤æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°ä¸€ä¸ªè‡ªæ—‹é”ï¼Œç¡¬ä»¶ä¼šä¿è¯è¿™äº›æŒ‡ä»¤çš„åŸå­æ€§&lt;/p&gt;

&lt;h4 id=&quot;test-and-setæŒ‡ä»¤&quot;&gt;test-and-setæŒ‡ä»¤&lt;/h4&gt;
&lt;p&gt;åˆå«atomic exchangeæŒ‡ä»¤ï¼Œè¿™ä¸ªæŒ‡ä»¤çš„å«ä¹‰å¯ä»¥ç”¨ä»¥ä¸‹ä»£ç æ¥è¡¨ç¤º&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Fetch&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;old&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;old&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;TestAndSet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;old_value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new_value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;old&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;old_value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;old_value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;new_value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;old&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ç”¨TASæŒ‡ä»¤å®ç°çš„è‡ªæ—‹é”å®šä¹‰å¦‚ä¸‹&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SpinLockWithTAS&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;public:
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;TestAndSet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Spin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Unlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;ss&quot;&gt;private:
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ç®€å•åˆ†æä¸€ä¸‹å®ƒçš„åŸç†ï¼šå½“ç¬¬ä¸€ä¸ªçº¿ç¨‹å¯¹ä¸€ä¸ªè‡ªæ—‹é”å¯¹è±¡è°ƒç”¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Lock&lt;/code&gt;æ—¶ï¼Œflagä¸º0ï¼Œå› æ­¤&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TestAndSet&lt;/code&gt;å°†flagç½®ä¸º1å¹¶è¿”å›0ï¼Œä¸ä¼šè¿›å…¥æ— é™å¾ªç¯ï¼ˆå›å¿†ä¸€ä¸‹ï¼Œ&lt;strong&gt;è¿™ä¸ªæŒ‡ä»¤è¿”å›åŸæ¥çš„å€¼&lt;/strong&gt;ï¼‰ã€‚å½“ç¬¬äºŒä¸ªçº¿ç¨‹ä¹Ÿè¯•å›¾è°ƒç”¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Lock&lt;/code&gt;æ–¹æ³•æ—¶ï¼Œä¾¿ä¼šç”±äºflagä¸º1è€Œè¿›å…¥è‡ªæ—‹ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Unlock&lt;/code&gt;æ–¹æ³•é‡Šæ”¾é”ï¼Œå¾ªç¯çš„åˆ¤æ–­æ¡ä»¶æ‰ä¼šå¤±æ•ˆ&lt;/p&gt;

&lt;h4 id=&quot;compare-and-swapæŒ‡ä»¤&quot;&gt;compare-and-swapæŒ‡ä»¤&lt;/h4&gt;
&lt;p&gt;åˆå«compare-and-exchangeæŒ‡ä»¤ï¼Œè¿™ä¸ªæŒ‡ä»¤çš„å«ä¹‰å¯ä»¥ç”¨ä»¥ä¸‹ä»£ç æ¥è¡¨ç¤º&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Compare&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;target&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&apos;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;expected&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;swap&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;otherwise&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nothing&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;original&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CompareAndSwap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;expected&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;original&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;original&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;expected&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;original&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ç”¨CASæŒ‡ä»¤å®ç°çš„è‡ªæ—‹é”å®šä¹‰å¦‚ä¸‹&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SpinLockWithCAS&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;public:
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;CompareAndSwap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Spin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Unlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;ss&quot;&gt;private:
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;åŸç†ä¸ç”¨TASçš„å®ç°ç›¸åŒ&lt;/p&gt;

&lt;h4 id=&quot;fetch-and-addæŒ‡ä»¤&quot;&gt;fetch-and-addæŒ‡ä»¤&lt;/h4&gt;
&lt;p&gt;å°†æŸä¸ªåœ°å€çš„å€¼åŠ ä¸€å¹¶è¿”å›åŸæ¥çš„å€¼ï¼Œä»£ç è¡¨ç¤ºå¦‚ä¸‹&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Atomically&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;increments&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;returning&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;old&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;FetchAndAdd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;old&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;old&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;old&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ç”¨è¿™ä¸ªæŒ‡ä»¤å¯ä»¥å®ç°ä¸€ç§æ›´é«˜çº§çš„&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ticket lock&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TicketLock&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;ss&quot;&gt;public:
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Lock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;my_turn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;FetchAndAdd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ticket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;turn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;my_turn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Spin&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Unlock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;turn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;ss&quot;&gt;private:
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ticket&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;turn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;åˆ†æä¸€ä¸‹è¯¥é”çš„åŸç†ï¼šæ¯ä¸ªè¯•å›¾åŠ é”çš„çº¿ç¨‹ä¼šè®©&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ticket&lt;/code&gt;åŠ ä¸€ï¼ŒåŒæ—¶ä¹Ÿè¡¨æ˜äº†æ¯ä¸ªçº¿ç¨‹å¯¹åº”çš„&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;turn&lt;/code&gt;ã€‚æ¯”å¦‚ç¬¬ä¸€ä¸ªè·å¾—çš„å°±æ˜¯0ï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯1ï¼Œä¾æ¬¡ç±»æ¨ã€‚å½“é”ä¿å­˜çš„&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;turn&lt;/code&gt;ä¸çº¿ç¨‹å¯¹åº”çš„&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;turn&lt;/code&gt;ä¸ç›¸ç­‰æ—¶ï¼Œçº¿ç¨‹ä¿æŒè‡ªæ—‹ã€‚ä»…å½“æŒæœ‰é”çš„çº¿ç¨‹è§£é”åï¼Œé”ä¿å­˜çš„&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;turn&lt;/code&gt;æ‰ä¼šå¢åŠ ï¼Œä¸‹ä¸€ä¸ªçº¿ç¨‹å°±èƒ½è·å¾—é”&lt;/p&gt;</content><author><name>CY</name></author><category term="Concurrency" /><summary type="html"></summary></entry><entry><title type="html">CppCon 2017: Carl Cook â€œWhen a Microsecond Is an Eternity: High Performance Trading Systems in C++â€</title><link href="/2022/11/28/Carl-Cook.html" rel="alternate" type="text/html" title="CppCon 2017: Carl Cook â€œWhen a Microsecond Is an Eternity: High Performance Trading Systems in C++â€" /><published>2022-11-28T00:00:00+08:00</published><updated>2022-11-28T00:00:00+08:00</updated><id>/2022/11/28/Carl%20Cook</id><content type="html" xml:base="/2022/11/28/Carl-Cook.html">&lt;!--more--&gt;
&lt;p&gt;å…³äºCarl Cookåœ¨CppCon 2017ä¸Šå¯¹ä½å»¶è¿Ÿä»£ç ä»‹ç»çš„ä¸€äº›ç¬”è®°&lt;/p&gt;
&lt;h2 id=&quot;slowpath-removal&quot;&gt;Slowpath removal&lt;/h2&gt;
&lt;p&gt;Bad:&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;checkForErrorA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;handleErrorA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;checkForErrorB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;handleErrorB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;checkForErrorC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;handleErrorC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sendOrderToExchange&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Good:&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;int64_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;errorFlags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;errorFlags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sendOrderToExchange&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;handleError&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;errorFlags&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;åŸå› åˆ†æï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;ç¬¬ä¸€ç§å†™æ³•åˆ†æ”¯è¾ƒå¤šï¼Œå½±å“ç¡¬ä»¶çš„åˆ†æ”¯é¢„æµ‹&lt;/li&gt;
  &lt;li&gt;ç¬¬ä¸€ç§å†™æ³•æŒ‡ä»¤è¾ƒå¤šï¼Œå½±å“ç¡¬ä»¶çš„æŒ‡ä»¤ç¼“å­˜&lt;/li&gt;
  &lt;li&gt;ç¬¬ä¸€ç§å†™æ³•ä¸­çš„checkå‡½æ•°ä¹Ÿæ˜¯æœ‰å¯èƒ½å½±å“æ•°æ®ç¼“å­˜çš„&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;template-based-configuration&quot;&gt;Template-based configuration&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨é…ç½®æ–‡ä»¶æ¥æ§åˆ¶ä»£ç èµ°å‘é€šå¸¸æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œæ¯”èµ·ä½¿ç”¨è™šå‡½æ•°ï¼Œæ¨¡æ¿èƒ½æ›´é«˜æ•ˆçš„å®Œæˆè¿™ä¸€å·¥ä½œï¼Œå› ä¸ºæ²¡æœ‰äº†è¿è¡Œæ—¶çš„å¼€é”€ï¼ŒåŒæ—¶å‡å°‘äº†åˆ†æ”¯ä»¥åŠä¸å¿…è¦çš„ä»£ç &lt;/p&gt;

&lt;p&gt;ä»£ç å®ä¾‹ï¼š&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OrderSenderA&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;SendOrder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OrderSenderB&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;SendOrder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;OrderManager&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kp&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;IOrderManager&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;MainLoop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;at&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;some&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stage&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;future&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;mOrderSender&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;SendOrder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;no&quot;&gt;T&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mOrderSender&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unique_ptr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;IOrderManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;UseOrderSenderA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;make_unique&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;OrderManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;OrderSenderA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;make_unique&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;OrderManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;OrderSenderB&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;manager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Factory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;manager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;MainLoop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æ€»ä¹‹ï¼Œå¦‚æœåœ¨ç¼–è¯‘æ—¶å°±èƒ½ç¡®å®šçš„äº‹æƒ…ï¼Œå°±ä¸éœ€è¦ç­‰åˆ°è¿è¡Œæ—¶å†å»åšï¼Œæé«˜ä»£ç è¿è¡Œé€Ÿåº¦&lt;/p&gt;

&lt;h2 id=&quot;lambda-functions-are-fast-and-convenient&quot;&gt;Lambda functions are fast and convenient&lt;/h2&gt;
&lt;p&gt;ä½œè€…è¡¨ç¤ºä½¿ç”¨Lambdaä¸ä¼šæ›´å¿«ï¼Œä½†æ˜¯å±•ç¤ºäº†C++çš„é«˜æ•ˆå’Œå¼ºå¤§ã€‚å¦‚æœåœ¨ç¼–è¯‘æ—¶èƒ½ç¡®å®šå°†è¢«æ‰§è¡Œçš„å‡½æ•°ï¼Œé‚£ä¹ˆå€¾å‘äºä½¿ç”¨Lambda&lt;/p&gt;

&lt;p&gt;ä»£ç å®ä¾‹ï¼š&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Definition&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;template&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;SendMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;auto&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PrepareMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;lambda&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Usage&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;SendMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;](&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;auto&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;instrument&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;price&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ä¸Šé¢çš„å‡½æ•°æœ‰å¯èƒ½è¢«ç¼–è¯‘å™¨ç›´æ¥å†…è”æˆä¸ºéå¸¸åº•å±‚çš„æ“ä½œï¼ˆä¾‹å¦‚ï¼Œä¸¤ä¸ªmovæŒ‡ä»¤ï¼‰ï¼Œä½†å´æ˜¯ç”¨é«˜çº§è¯­è¨€å†™å‡ºæ¥çš„ï¼Œç”±æ­¤å¯è§ä¸ºä»€ä¹ˆC++æˆäº†ä½å»¶è¿Ÿç³»ç»Ÿçš„é€‰æ‹©&lt;/p&gt;

&lt;h2 id=&quot;memory-allocation&quot;&gt;Memory allocation&lt;/h2&gt;
&lt;p&gt;å†…å­˜çš„åˆ†é…éå¸¸æ…¢ï¼Œå› æ­¤å°½é‡é¿å…å†…å­˜åˆ†é…ã€‚å¯èƒ½çš„ä¼˜åŒ–æªæ–½åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;ä½¿ç”¨æ± åŒ–æŠ€æœ¯ï¼Œé¢„åˆ†é…å¥½ä¸€äº›å¯¹è±¡&lt;/li&gt;
  &lt;li&gt;é¿å…é‡Šæ”¾å¯¹è±¡ï¼Œå°½é‡å¤ç”¨å¯¹è±¡
    &lt;ul&gt;
      &lt;li&gt;deleteä¸ä¼šå¼•èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œå†…å­˜ä¹Ÿæ²¡æœ‰è¢«è¿˜ç»™æ“ä½œç³»ç»Ÿã€‚ä½†æ˜¯glibcçš„freeå‡½æ•°æœ‰å¤§æ¦‚400è¡Œçš„è®°å½•ä»£ç &lt;/li&gt;
      &lt;li&gt;é‡å¤ä½¿ç”¨å¯¹è±¡å¯ä»¥å¸®åŠ©å‡å°‘å†…å­˜ç¢ç‰‡&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å¦‚æœä¸€å®šè¦é”€æ¯å¤§çš„å¯¹è±¡ï¼Œå°½é‡åœ¨å…¶ä»–çº¿ç¨‹åš&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;exceptions&quot;&gt;Exceptions&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;ä¸è¦å®³æ€•ä½¿ç”¨å¼‚å¸¸ï¼ˆå¦‚æœä½¿ç”¨gcc, clangæˆ–è€…msvcï¼‰ã€‚åªè¦å¼‚å¸¸æ²¡æœ‰è¢«æŠ›å‡ºå°±æ²¡æœ‰å¼€é”€&lt;/li&gt;
  &lt;li&gt;ä¸è¦åœ¨æ§åˆ¶æµä¸­ä½¿ç”¨å¼‚å¸¸ï¼Œè¿™ä¼šå¯¼è‡´è‡³å°‘1.5usçš„å¼€é”€ï¼Œè€Œä¸”ä»£ç ä¼šå¾ˆéš¾çœ‹&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;prefer-templates-to-branches&quot;&gt;Prefer templates to branches&lt;/h2&gt;
&lt;p&gt;è·Ÿå‰é¢çš„æœ‰ç‚¹ç±»ä¼¼ï¼Œä¹Ÿæ˜¯åˆ†æ”¯æ¶ˆé™¤çš„æŠ€æœ¯ã€‚å¦‚æœå·²ç»é¢„å…ˆçŸ¥é“æ‰€æœ‰é€‰æ‹©ä»¥åŠå¯¹åº”å¦‚ä½•å¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡æ¿æ¥å»é™¤åˆ†æ”¯&lt;/p&gt;

&lt;p&gt;ä»£ç å®ä¾‹ï¼š&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Branching&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;approach&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;enum&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Side&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Buy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Sell&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;RunStrategy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Side&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;side&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;orderPrice&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CalcPrice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;side&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fairValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;credit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;no&quot;&gt;CheckRiskLimits&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;side&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;orderPrice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;no&quot;&gt;SendOrder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;side&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;orderPrice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CalcPrice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Side&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;side&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;credit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;side&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Side&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Buy&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;credit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;credit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Templated&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;approach&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Side&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Strategy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;RunStrategy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CalcPrice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fairValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;credit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;no&quot;&gt;CheckRiskLimits&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;orderPrice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;no&quot;&gt;SendOrder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;orderPrice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Strategy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Side&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Buy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;CalcPrice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;credit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;credit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Strategy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Side&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;Sell&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;::&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;CalcPrice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;credit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;credit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;å¹¶ä¸æ˜¯æ‰€æœ‰çš„åˆ†æ”¯è¯­å¥éƒ½éœ€è¦è¿™æ ·å¤„ç†ï¼Œåªéœ€è¦ä¿è¯hotpathèƒ½æœ€å¿«è¿è¡Œå³å¯&lt;/p&gt;

&lt;h2 id=&quot;multi-threading&quot;&gt;Multi-threading&lt;/h2&gt;
&lt;p&gt;æœ€å¥½é¿å…ä½¿ç”¨å¤šçº¿ç¨‹&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;æ•°æ®åŒæ­¥å¼€é”€å¾ˆå¤§&lt;/li&gt;
  &lt;li&gt;æ— é”ç¼–ç¨‹å¯èƒ½ä»ç„¶éœ€è¦ç¡¬ä»¶é”&lt;/li&gt;
  &lt;li&gt;å¤šçº¿ç¨‹ä»£ç éš¾è¯»æ‡‚&lt;/li&gt;
  &lt;li&gt;ç”Ÿäº§è€…å®¹æ˜“ä½¿æ¶ˆè´¹è€…é¥±å’Œ
å¦‚æœä¸€å®šè¦ä½¿ç”¨ï¼š&lt;/li&gt;
  &lt;li&gt;å°½å¯èƒ½å…±äº«å°‘çš„æ•°æ®ã€‚å¤šçº¿ç¨‹å†™åŒä¸€ä¸ªç¼“å­˜æ—¶å®¹æ˜“å¢åŠ å¼€é”€&lt;/li&gt;
  &lt;li&gt;è€ƒè™‘å¤åˆ¶æ•°æ®è€Œéå…±äº«æ•°æ®ã€‚ä¾‹å¦‚ï¼šsingle writerï¼Œsingle reader lock free queue&lt;/li&gt;
  &lt;li&gt;å¦‚æœä¸€å®šè¦å…±äº«æ•°æ®ï¼Œè€ƒè™‘ä¸ä½¿ç”¨åŒæ­¥&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;data-lookups&quot;&gt;Data lookups&lt;/h2&gt;
&lt;p&gt;å‡è®¾ä»å¸‚åœºä¸­æ‰¾åˆ°æŸæ”¯è‚¡ç¥¨çš„ä»·æ ¼ï¼Œä¸”å®ƒä»¬ä½¿ç”¨marketIdè¿›è¡Œå…³è”ï¼Œå¸¸è§„åšæ³•&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Market&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int32_t&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shortName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int16_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;quantityMultiplier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Instrument&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;price&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;marketId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;no&quot;&gt;Message&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;orderMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;orderMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;price&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;instrument&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;price&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;no&quot;&gt;Market&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;market&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Markets&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;FindMarket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;instrument&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;marketId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;orderMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;qty&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;market&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;quantityMultiplier&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;qty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æ›´å¥½çš„åšæ³•&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Market&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int32_t&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shortName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int16_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;quantityMultiplier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Instrument&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;price&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;marketId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;int16_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;quantityMultiplier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ä¼˜åŒ–çš„åŸç†åœ¨äºï¼Œä»ç¼“å­˜ä¸­ä¸€æ¬¡æ€§å–å‡ºæ‰€æœ‰éœ€è¦çš„æ•°æ®ã€‚ç¬¬ä¸€ä¸ªåšæ³•å…ˆè¯»instrument.priceï¼Œå½“æˆ‘ä»¬éœ€è¦è¯»å–è¿™4ä¸ªå­—èŠ‚æ—¶ï¼Œæˆ‘ä»¬å…¶å®ä¼šè¯»å–64ä¸ªå­—èŠ‚åˆ°ç¼“å­˜è¡Œä¸­ï¼ˆç¡¬ä»¶ç»“æ„å¦‚æ­¤ï¼‰è¿™æ„å‘³ç€æ•´ä¸ªInstrumentç»“æ„ä½“éƒ½å°†è¢«åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œç„¶ååˆè®¿é—®äº†market.quantityMultiplierï¼Œéœ€è¦å°†æ•´ä¸ªMarketç»“æ„ä½“åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œè¿™å°±æœ‰å¯èƒ½å‘ç”Ÿç¼“å­˜æœªå‘½ä¸­ä»è€Œå½±å“é€Ÿåº¦ã€‚ç¬¬äºŒä¸ªåšæ³•åŠ è½½äº†Instrumentç»“æ„ä½“åï¼Œå› ä¸ºç¼“å­˜çš„å­˜åœ¨ï¼Œæˆ‘ä»¬æ— éœ€å…¶ä»–å¼€é”€å°±èƒ½è¯»åˆ°ç¬¬äºŒä¸ªå€¼ã€‚æ¯”èµ·èŠ‚çœçš„å†…å­˜æ¥è¯´ï¼Œè¿˜æ˜¯æå‡çš„é€Ÿåº¦æ›´ä¸ºé‡è¦&lt;/p&gt;

&lt;h2 id=&quot;fast-associative-containersstdunordered_map&quot;&gt;Fast associative containers(std::unordered_map)&lt;/h2&gt;
&lt;p&gt;æ ‡å‡†åº“çš„å“ˆå¸Œè¡¨åœ¨å‘ç”Ÿå†²çªæ—¶ï¼Œä½¿ç”¨é“¾è¡¨è¿æ¥å†²çªçš„å“ˆå¸Œå€¼ï¼Œè¿™å°†ä¼šæ¯”é¡ºåºè®¿é—®å†…å­˜æ…¢å¾—å¤š
å¦ä¸€ç§è§£å†³å†²çªçš„æ–¹æ³•æ˜¯å¼€æ”¾å¯»å€æ³•ï¼Œå³å†²çªä¹‹åå°†æ•°æ®æ”¾åœ¨ä¸‹ä¸€ä¸ªä½ç½®
Optiverçš„åšæ³•æ˜¯ï¼šä¸¤è€…ç»“åˆ
å“ˆå¸Œè¡¨å­˜æ”¾çš„æ˜¯å“ˆå¸Œå€¼å’ŒæŒ‡é’ˆçš„pairï¼Œå› æ­¤æ¯ä¸ªpairæ˜¯16å­—èŠ‚ï¼Œæ‰€ä»¥æ¯ä¸ªç¼“å­˜è¡Œä¼šè¯»åˆ°4ä¸ªpairï¼ˆå›æƒ³ä¸€ä¸‹ï¼Œç¼“å­˜è¡Œæ˜¯64å­—èŠ‚ï¼‰
æ ¹æ®å“ˆå¸Œå€¼å¾—åˆ°çš„ç´¢å¼•å»æ‰¾ï¼Œå¦‚æœå“ˆå¸Œå€¼ä¸åŒ¹é…å°±ç›´æ¥å»ä¸‹ä¸€ä¸ªç´¢å¼•ï¼Œå¯¹ç¼“å­˜å¾ˆå‹å¥½&lt;/p&gt;

&lt;h2 id=&quot;always-inline-and-noinline&quot;&gt;((always inline)) and ((noinline))&lt;/h2&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªé€‰é¡¹å¯¹ç¼–è¯‘å™¨æ¥è¯´å½±å“å¾ˆå¤§ï¼Œæœ€å¥½ç»è¿‡æµ‹è¯•å†å†³å®šæ˜¯å¦è¦å†…è”&lt;/p&gt;

&lt;p&gt;ä»£ç å®ä¾‹&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;no&quot;&gt;CheckMarket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;notGoingToSendAnOrder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;no&quot;&gt;ComplexLoggingFunction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;no&quot;&gt;SendOrder&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;__attribute__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;noline&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ComplexLoggingFunction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ä¸ºä»€ä¹ˆè¿™é‡Œä¸€å®šä¸è¦å†…è”ï¼Ÿå› ä¸ºå‘é€è®¢å•æ‰æ˜¯hotpathï¼Œå¦‚æœè¿›è¡Œäº†å†…è”ï¼Œé‚£ä¹ˆhotpathä¸­å°±ä¼šå……æ–¥æ¯«æ— å¿…è¦çš„æ‰“å°æ—¥å¿—çš„æŒ‡ä»¤ï¼Œä»è€Œå½±å“äº†æŒ‡ä»¤ç¼“å­˜çš„æ€§èƒ½ã€‚å¦‚æœä¸å†…è”ï¼Œé‚£ä¹ˆå®ƒåªæ˜¯ä¸€ä¸ªcallè°ƒç”¨ï¼Œè€Œä¸”æ›´æœ‰åˆ©äºè¿›è¡Œåˆ†æ”¯é¢„æµ‹&lt;/p&gt;

&lt;h2 id=&quot;keeping-the-cache-hot&quot;&gt;Keeping the cache hot&lt;/h2&gt;
&lt;p&gt;è¦è®°ä½ï¼Œhotpathæ˜¯å¾ˆå°‘è¢«å®Œå…¨æ‰§è¡Œåˆ°çš„ï¼Œä¸­é—´å¯èƒ½å› ä¸ºå„ç§å› ç´ è€Œåœæ­¢å‘é€è®¢å•ï¼Œæ¯”å¦‚é£æ§ã€æŒä»“é™åˆ¶ï¼Œç­‰ç­‰ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç¼“å­˜ä¸­å¯èƒ½å……æ–¥ç€éhotpathçš„æ•°æ®å’ŒæŒ‡ä»¤
ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼šé¢‘ç¹çš„å‡è£…å‘é€è®¢å•ï¼Œä¸€ç›´ä¿æŒç¼“å­˜æ˜¯å‡†å¤‡å°±ç»ªçš„çŠ¶æ€ã€‚æœ‰çš„ä½å»¶è¿Ÿç½‘å¡ï¼ˆMellanox, Solar Flareï¼‰ç”šè‡³æ”¯æŒå°†æ•°æ®å†™åˆ°å¡é‡Œä½†ä¸å‘é€ï¼Œå°±æ˜¯ä¸ºäº†è¿™ä¸€ç›®çš„&lt;/p&gt;</content><author><name>CY</name></author><category term="Low_Latency" /><summary type="html"></summary></entry><entry><title type="html">THU OS Lab1</title><link href="/2021/04/16/OSLab1.html" rel="alternate" type="text/html" title="THU OS Lab1" /><published>2021-04-16T00:00:00+08:00</published><updated>2021-04-16T00:00:00+08:00</updated><id>/2021/04/16/OSLab1</id><content type="html" xml:base="/2021/04/16/OSLab1.html">&lt;p&gt;æ“ä½œç³»ç»Ÿå®éªŒ1
&lt;!--more--&gt;&lt;/p&gt;
&lt;h2 id=&quot;ç»ƒä¹ 1&quot;&gt;ç»ƒä¹ 1&lt;/h2&gt;
&lt;h3 id=&quot;1-æ“ä½œç³»ç»Ÿé•œåƒæ–‡ä»¶ucoreimgæ˜¯å¦‚ä½•ä¸€æ­¥ä¸€æ­¥ç”Ÿæˆçš„&quot;&gt;1. æ“ä½œç³»ç»Ÿé•œåƒæ–‡ä»¶ucore.imgæ˜¯å¦‚ä½•ä¸€æ­¥ä¸€æ­¥ç”Ÿæˆçš„&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;å…ˆç”Ÿæˆkernelå’Œbootblockï¼Œç„¶åç”Ÿæˆucore.imgï¼ˆéœ€è¦ç ”ç©¶ä¸‹MakeFileçš„å†™æ³•ï¼Œå…´è¶£ä¸å¤§ï¼‰&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-ä¸€ä¸ªè¢«ç³»ç»Ÿè®¤ä¸ºæ˜¯ç¬¦åˆè§„èŒƒçš„ç¡¬ç›˜ä¸»å¼•å¯¼æ‰‡åŒºçš„ç‰¹ç‚¹&quot;&gt;2. ä¸€ä¸ªè¢«ç³»ç»Ÿè®¤ä¸ºæ˜¯ç¬¦åˆè§„èŒƒçš„ç¡¬ç›˜ä¸»å¼•å¯¼æ‰‡åŒºçš„ç‰¹ç‚¹&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;åªæœ‰512ä¸ªå­—èŠ‚&lt;/li&gt;
  &lt;li&gt;æœ€åä¸¤å­—èŠ‚æ˜¯&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x55AA&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;ç”±ä¸è¶…è¿‡466å­—èŠ‚çš„å¯åŠ¨ä»£ç å’Œä¸è¶…è¿‡64å­—èŠ‚çš„ç¡¬ç›˜åˆ†åŒºè¡¨åŠ ä¸Šç»“æŸç¬¦æ„æˆ&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ç»ƒä¹ 2&quot;&gt;ç»ƒä¹ 2&lt;/h2&gt;
&lt;p&gt;å…ˆè®°å½•ä¸€ä¸‹åœ¨eclipseä¸­ç”¨gdbå’Œqemuè°ƒè¯•çš„æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;é…ç½®External Tools Configurationsï¼Œå…¶ä¸­çš„argumentså¯ä»¥æŒ‡å®šmakeçš„å‚æ•°ï¼Œç„¶åå‚è€ƒMakeFileç¡®å®š&lt;/li&gt;
  &lt;li&gt;é…ç½®Debug Configurationsï¼Œå…¶ä¸­çš„Commandsæ å¯ä»¥æŒ‡å®šgdbçš„æŒ‡ä»¤åºåˆ—&lt;/li&gt;
  &lt;li&gt;å…ˆå¯åŠ¨qemuï¼Œè®©å…¶è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ˆé€šè¿‡MakeFileï¼‰ï¼Œç„¶åå¯åŠ¨gdbï¼Œè®©å…¶è·Ÿqemuå»ºç«‹è¿æ¥ï¼Œæ¯”å¦‚ä½¿ç”¨å¦‚ä¸‹çš„å‚æ•°ï¼š
    &lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;architecture&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i8086&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;target&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remote&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1234&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;å¦‚æœä¸ç”¨eclipseï¼Œå¯ä»¥ç›´æ¥å†™ä¸€ä¸ªæ–‡ä»¶ä¿å­˜gdbçš„è¿è¡ŒæŒ‡ä»¤ï¼Œç„¶ååœ¨MakeFileä¸­åŠ ä¸€ä¸ªé€‰é¡¹æŒ‡å‘è¿™ä¸ªæ–‡ä»¶ï¼ˆå…·ä½“å‚è€ƒå…¶ä»–å·²æœ‰çš„é€‰é¡¹ï¼‰&lt;/p&gt;

&lt;h3 id=&quot;1-ä»cpuåŠ ç”µåæ‰§è¡Œçš„ç¬¬ä¸€æ¡æŒ‡ä»¤å¼€å§‹å•æ­¥è·Ÿè¸ªbiosçš„æ‰§è¡Œ&quot;&gt;1. ä»CPUåŠ ç”µåæ‰§è¡Œçš„ç¬¬ä¸€æ¡æŒ‡ä»¤å¼€å§‹ï¼Œå•æ­¥è·Ÿè¸ªBIOSçš„æ‰§è¡Œ&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;ä½¿ç”¨ä¸Šè¿°çš„ä¸¤æ¡æŒ‡ä»¤å¯åŠ¨gdbå°±å¯ä»¥è¾¾åˆ°æ•ˆæœï¼Œæ ¹æ®è®²è¯¾çš„è§†é¢‘çŸ¥é“ç¬¬ä¸€æ¡æŒ‡ä»¤åœ¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0xffff0&lt;/code&gt;å¤„ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤
    &lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;/2i 0xffff0
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;æŸ¥çœ‹ç›¸åº”çš„biosä»£ç &lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-åœ¨åˆå§‹åŒ–ä½ç½®0x7c00è®¾ç½®å®åœ°å€æ–­ç‚¹æµ‹è¯•æ–­ç‚¹æ­£å¸¸&quot;&gt;2. åœ¨åˆå§‹åŒ–ä½ç½®0x7c00è®¾ç½®å®åœ°å€æ–­ç‚¹ï¼Œæµ‹è¯•æ–­ç‚¹æ­£å¸¸&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;åŠ ä¸Š&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;b 0x7c00&lt;/code&gt;å³å¯&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;3-ä»0x7c00å¼€å§‹è·Ÿè¸ªä»£ç è¿è¡Œå°†å•æ­¥è·Ÿè¸ªåæ±‡ç¼–å¾—åˆ°çš„ä»£ç ä¸bootasmså’Œbootblockasmè¿›è¡Œæ¯”è¾ƒ&quot;&gt;3. ä»0x7c00å¼€å§‹è·Ÿè¸ªä»£ç è¿è¡Œï¼Œå°†å•æ­¥è·Ÿè¸ªåæ±‡ç¼–å¾—åˆ°çš„ä»£ç ä¸bootasm.Så’Œbootblock.asmè¿›è¡Œæ¯”è¾ƒ&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;åœ¨eclipseè°ƒè¯•å™¨ä¸­å¯ä»¥çœ‹åˆ°ç›¸åº”çš„æ±‡ç¼–ä»£ç &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;4-è‡ªå·±æ‰¾ä¸€ä¸ªbootloaderæˆ–å†…æ ¸ä¸­çš„ä»£ç ä½ç½®è®¾ç½®æ–­ç‚¹å¹¶è¿›è¡Œè°ƒè¯•&quot;&gt;4. è‡ªå·±æ‰¾ä¸€ä¸ªbootloaderæˆ–å†…æ ¸ä¸­çš„ä»£ç ä½ç½®ï¼Œè®¾ç½®æ–­ç‚¹å¹¶è¿›è¡Œè°ƒè¯•&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;è‡ªç”±å‘æŒ¥&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ç»ƒä¹ -3&quot;&gt;ç»ƒä¹  3&lt;/h2&gt;
&lt;h3 id=&quot;åˆ†æbootloaderè¿›å…¥ä¿æŠ¤æ¨¡å¼çš„è¿‡ç¨‹&quot;&gt;åˆ†æbootloaderè¿›å…¥ä¿æŠ¤æ¨¡å¼çš„è¿‡ç¨‹&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;æŸ¥çœ‹bootasm.Sæºç å¯çŸ¥ï¼Œé¦–å…ˆè¦ä½¿èƒ½A20æ€»çº¿ï¼Œç„¶ååˆå§‹åŒ–GDTè¡¨ï¼ˆåœ¨bootasm.Sä¸­ï¼‰ï¼Œæœ€åæŠŠcr0å¯„å­˜å™¨ç½®1ä»è€Œä½¿èƒ½ä¿æŠ¤æ¨¡å¼&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ç»ƒä¹ 4&quot;&gt;ç»ƒä¹ 4&lt;/h2&gt;
&lt;h3 id=&quot;1-bootloaderå¦‚ä½•è¯»å–ç¡¬ç›˜æ‰‡åŒº&quot;&gt;1. bootloaderå¦‚ä½•è¯»å–ç¡¬ç›˜æ‰‡åŒº&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;readsectå‡½æ•°
    &lt;h3 id=&quot;2-bootloaderå¦‚ä½•åŠ è½½elfæ ¼å¼çš„os&quot;&gt;2. bootloaderå¦‚ä½•åŠ è½½ELFæ ¼å¼çš„OS&lt;/h3&gt;
  &lt;/li&gt;
  &lt;li&gt;bootmainå‡½æ•°ï¼Œéå†æ‰€æœ‰çš„program headeræ®µä¾æ¬¡è¯»å–ï¼Œç„¶åè°ƒç”¨entry point&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ç»ƒä¹ 5&quot;&gt;ç»ƒä¹ 5&lt;/h2&gt;
&lt;h3 id=&quot;å®Œæˆprint_stackframeçš„å®ç°&quot;&gt;å®Œæˆ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;print_stackframe&lt;/code&gt;çš„å®ç°&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;å…ˆçœ‹å®éªŒæŒ‡å¯¼ä¹¦äº†è§£è°ƒç”¨æ ˆçš„ç»“æ„ï¼Œç„¶åæ ¹æ®æ³¨é‡Šå¯ä»¥å¾ˆè½»æ¾çš„å†™å‡ºå®ç°ã€‚è¿™é‡Œä¸»è¦æ˜¯å¯¹Cè¯­è¨€ä¸ç†Ÿæ‰€ä»¥ä¸ä¼šå°†32ä½æ•´æ•°è½¬æˆåœ°å€å»è¯»æ•°æ®ï¼Œå‚è€ƒäº†ç­”æ¡ˆå†™å‡ºæ¥çš„
    &lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;print_stackframe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ebp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;read_ebp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;read_eip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;STACKFRAME_DEPTH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;cprintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ebp:0x%08x eip:0x%08x &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ebp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;eip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;uint32_t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uint32_t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ebp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;é€šè¿‡å¼ºè½¬æˆæŒ‡é’ˆæ¥æŠŠæ•´æ•°å½“ä½œåœ°å€&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;cprintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;args:0x%08x 0x%08x 0x%08x 0x%08x&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ç›´æ¥é€šè¿‡ç´¢å¼•å®ç°å¯¹åœ°å€çš„é¡ºåºè®¿é—®&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;cprintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;print_debuginfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;eip&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;eip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uint32_t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ebp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;åŒç†ï¼Œè½¬æˆæŒ‡é’ˆå¹¶ç”¨ç´¢å¼•æ¥è¯»åœ°å€ä¸­çš„å€¼ã€‚è®°ä½è¿”å›åœ°å€å­˜æ”¾åœ¨&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ebp&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;çš„ä¸Šé¢&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ä½çš„åœ°å€ä¸­&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;ebp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;uint32_t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ebp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ä¸Šä¸€ä¸ª&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ebp&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;å­˜æ”¾åœ¨&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ebp&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;å¯¹åº”çš„åœ°å€ä¸­&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ç»ƒä¹ 6&quot;&gt;ç»ƒä¹ 6&lt;/h2&gt;
&lt;h3 id=&quot;1-ä¸­æ–­æè¿°ç¬¦è¡¨ä¸­ä¸€ä¸ªè¡¨é¡¹å å¤šå°‘å­—èŠ‚å“ªå‡ ä½ä»£è¡¨ä¸­æ–­å¤„ç†ä»£ç çš„å…¥å£&quot;&gt;1. ä¸­æ–­æè¿°ç¬¦è¡¨ä¸­ä¸€ä¸ªè¡¨é¡¹å å¤šå°‘å­—èŠ‚ï¼Ÿå“ªå‡ ä½ä»£è¡¨ä¸­æ–­å¤„ç†ä»£ç çš„å…¥å£ï¼Ÿ&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;8å­—èŠ‚ã€‚å¯ä»¥åœ¨&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mmu.h&lt;/code&gt;ä¸­çœ‹åˆ°&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;gatedesc&lt;/code&gt;çš„å®šä¹‰ï¼Œå…¶ä¸­ç¬¬0~15ä½æ˜¯åç§»é‡çš„ä½16ä½ï¼Œç¬¬16~31ä½æ˜¯æ®µé€‰æ‹©å­ï¼Œç¬¬48~63ä½æ˜¯åç§»é‡çš„é«˜16ä½ã€‚é€šè¿‡æ®µé€‰æ‹©å­ä»å…¨å±€æè¿°ç¬¦è¡¨æ‰¾åˆ°ç›¸åº”çš„æ®µåŸºå€ï¼Œç„¶åé€šè¿‡åç§»é‡æ‰¾åˆ°ä¸­æ–­ä¾‹ç¨‹çš„å…¥å£&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2-å®Œæˆidt_initå‡½æ•°&quot;&gt;2. å®Œæˆ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;idt_init&lt;/code&gt;å‡½æ•°&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;æœ‰äº›å­˜ç–‘çš„åœ°æ–¹ï¼Œä¸»è¦æ˜¯å¯¹ç¬¬ä¸‰ä¸ªå‚æ•°GD_KTEXTä¸å¤ªç†è§£ï¼Œç›®å‰å…ˆç†è§£ä¸ºå› ä¸º&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;vectors&lt;/code&gt;ä¸­çš„ä¸­æ–­æœåŠ¡ä¾‹ç¨‹éƒ½æ”¾åœ¨äº†å†…æ ¸çš„ä»£ç æ®µï¼Œæ‰€ä»¥æ‰€æœ‰çš„æ®µé€‰æ‹©å­éƒ½å¡«è¿™ä¸ª
    &lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idt_init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;uintptr_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__vectors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[];&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;no&quot;&gt;SETGATE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;GD_KTEXT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__vectors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DPL_KERNEL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;é¡¹ï¼Œæ˜¯å¦ä¸ºç³»ç»Ÿè°ƒç”¨ï¼Œæ®µé€‰æ‹©å­ï¼Œåç§»é‡ï¼Œç‰¹æƒçº§åˆ«&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;no&quot;&gt;SETGATE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;T_SWITCH_TOK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;GD_KTEXT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__vectors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;T_SWITCH_TOK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;DPL_USER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;sr&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ä»ç”¨æˆ·åˆ‡åˆ°å†…æ ¸æ˜¯ç”¨æˆ·ç‰¹æƒçº§&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;lidt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;idt_pd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;3-å®Œæˆtrapå‡½æ•°&quot;&gt;3. å®Œæˆ&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;trap&lt;/code&gt;å‡½æ•°&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;åªå®Œæˆäº†æ—¶é’Ÿä¸­æ–­
    &lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;IRQ_OFFSET&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;IRQ_TIMER&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ticks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ticks&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;TICK_NUM&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;print_ticks&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;</content><author><name>CY</name></author><category term="OS" /><summary type="html">æ“ä½œç³»ç»Ÿå®éªŒ1</summary></entry><entry><title type="html">Hello World!</title><link href="/2021/04/15/Hello-World.html" rel="alternate" type="text/html" title="Hello World!" /><published>2021-04-15T00:00:00+08:00</published><updated>2021-04-15T00:00:00+08:00</updated><id>/2021/04/15/Hello-World</id><content type="html" xml:base="/2021/04/15/Hello-World.html">&lt;!--more--&gt;
&lt;p&gt;ç»è¿‡å¤§æ¦‚ä¸€ä¸ªä¸‹åˆï¼Œæˆ‘çš„githubåšå®¢ç»ˆäºæ­å¥½äº†:tada:ä¹‹å‰çœ‹&lt;a href=&quot;https://bot-man-jl.github.io&quot;&gt;ç¿å“¥çš„åšå®¢&lt;/a&gt;çš„æ—¶å€™å°±è§‰å¾—github.ioçš„åšå®¢çœ‹èµ·æ¥æ¯”CSDNæœ‰é€¼æ ¼å¤šäº†ï¼Œèº«ä¸ºé¢œå€¼æ§çš„æˆ‘æ€ä¹ˆèƒ½ä¸è¯•ä¸€è¯•å‘¢ï¼Ÿäºæ˜¯ä»Šå¤©ä¸‹åˆæ‘¸äº†ä¸ªé±¼ï¼Œæ‰¾äº†ç¯‡&lt;a href=&quot;https://keysaim.github.io/post/blog/2017-08-15-how-to-setup-your-github-io-blog/&quot;&gt;æ•™ç¨‹&lt;/a&gt;æ­äº†ä¸€ä¸‹&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;æ€»ç»“ä¸€ä¸‹å¤§æ¦‚çš„æµç¨‹å§&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;é¦–å…ˆéœ€è¦åœ¨è‡ªå·±çš„githubç›®å½•æ–°å»ºä¸€ä¸ªä»“åº“ï¼Œè¿™ä¸ªä»“åº“åæ˜¯username.github.io(usernameæ˜¯ä½ çš„githubç”¨æˆ·å)&lt;/li&gt;
  &lt;li&gt;å‘è¿™ä¸ªç›®å½•ä¸­å¢åŠ é™æ€æ–‡ä»¶ï¼Œç„¶åè®¿é—® https://username.github.io å°±ä¼šçœ‹åˆ°æ¸²æŸ“å‡ºæ¥çš„æ•ˆæœã€‚githubé»˜è®¤ä½¿ç”¨Jekyllæ¡†æ¶è¿›è¡Œç½‘ç«™çš„æ„å»º&lt;/li&gt;
  &lt;li&gt;å½“ç„¶ï¼Œå®Œå…¨è‡ªå·±å†™ç½‘é¡µæ˜¯ä¸å¯èƒ½çš„ï¼Œæ¯•ç«Ÿä¸æ˜¯æ‰€æœ‰äººéƒ½æ‡‚å‰ç«¯ï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥å°±æ˜¯æŒ‘é€‰ä¸€æ¬¾å–œæ¬¢çš„ä¸»é¢˜:ghost:æˆ‘éšä¾¿æœäº†ä¸€äº›é€‰ä¸­äº†ç°åœ¨è¿™ä¸ªTeXt&lt;/li&gt;
  &lt;li&gt;å®‰è£…çš„æ•™ç¨‹å¯ä»¥å‚ç…§&lt;a href=&quot;https://tianqi.name/jekyll-TeXt-theme/docs/en/quick-start&quot;&gt;TeXtçš„å®˜ç½‘&lt;/a&gt;è¿›è¡Œï¼Œå…¶å®å°±æ˜¯æŠŠå¤§ä½¬çš„ç½‘ç«™æ‹·è´ä¸€ä»½åˆ°è‡ªå·±çš„repoï¼Œç„¶åè‡ªå·±åªéœ€è¦æ›´æ”¹ä¸€äº›é…ç½®ï¼Œå¡«å……å†…å®¹å³å¯&lt;/li&gt;
  &lt;li&gt;å¦‚æœè¦æœ¬åœ°è°ƒè¯•çš„è¯ï¼Œéœ€è¦é¢å¤–å®‰è£…ä¸€äº›å·¥å…·ï¼Œä¸­é—´é‡åˆ°æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ä¸‹é¢çš„ä»£ç æ‰§è¡ŒæŠ¥é”™&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;bundle&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;jekyll&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;serve&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;æŠ¥é”™ä¿¡æ¯å¤§æ¦‚æ˜¯&lt;/p&gt;

&lt;p class=&quot;error&quot;&gt;cannot load such file â€“ webrick (LoadError)&lt;/p&gt;
&lt;p&gt;äºæ˜¯æˆ‘åœ¨Jekyllçš„githubä»“åº“issuesä¸­æœç´¢äº†ä¸€ä¸‹ï¼Œç»ˆäºæ‰¾åˆ°äº†&lt;a href=&quot;https://github.com/jekyll/jekyll/issues/8531&quot;&gt;è§£å†³æ–¹æ³•&lt;/a&gt;ï¼Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤å³å¯ï¼š&lt;/p&gt;
&lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;bundle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;add&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;webrick&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;ç„¶åå†æ‰§è¡Œä¹‹å‰çš„å‘½ä»¤å°±å¯ä»¥åœ¨localhost:4000é¢„è§ˆæœ¬åœ°çš„ç½‘ç«™æ•ˆæœäº†&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;ä¸€äº›æœ‰ç”¨çš„é“¾æ¥&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://tianqi.name/jekyll-TeXt-theme/test/&quot;&gt;TeXt Home&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/ikatyang/emoji-cheat-sheet/blob/master/README.md&quot;&gt;Emoji cheat list&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>CY</name></author><category term="HelloWorld!" /><summary type="html"></summary></entry></feed>